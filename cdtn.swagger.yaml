openapi: 3.0.4
info:
  title: Chuyên đề tốt nghiệp quản lí quán ăn
  description: |-

  termsOfService: https://swagger.io/terms/
  contact:
    email: apiteam@swagger.io
  license:
    name: Apache 2.0
    url: https://www.apache.org/licenses/LICENSE-2.0.html
  version: 1.0.12
externalDocs:
  description: Find out more about Swagger
  url: https://swagger.io
servers:
  - url: https://snackio-ten.vercel.app/admin
  - url: https://cdtn-be-one.vercel.app/guest
  - url: http://localhost:3000/admin
  - url: http://localhost:3000/guest
  - url: https://api.snackio.io.vn/admin
tags:
  - name: Account
    description: Các logic liên quan đến account
  - name: Table
    description: Các logic liên quan đến table
  - name: Supplier
    description: Các logic liên quan đến supplier
  - name: Permission
    description: Các logic liên quan đến Permission
  - name: Role
    description: Các logic liên quan đến Role
  - name: Ingredient
    description: Các logic liên quan đến Ingredient
  - name: Import Orders
    description: Các logic liên quan đến Import Orders
  - name: Category Ingredient
    description: Các logic liên quan đến Category Ingredient
  - name: Dishes
    description: Các logic liên quan đến Dishes
  - name: Dish Category
    description: Các logic liên quan đến Dish Category
  - name: Orders
    description: Quản lý đơn hàng (Admin)
  - name: Admin Reviews
    description: Quản lý đánh giá (Admin)

  - name: Guest Auth
    description: Đăng nhập bên khách hàng
  - name: Guest 
    description: Logic bên khách hàng
paths:
  /accounts/login:
    post:
      tags:
        - Account
      summary: Đăng nhập
      description: Đăng nhập
      operationId: login
      requestBody:
        description: Thông tin đăng nhập
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  example: admin1@gmail.com
                password:
                  type: string
                  example: MinhOkela123#@
        required: true
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: 
                    type: string
                    example: "Login successful"
                  result: 
                    type: object
                    example:
                      accesss_token:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNjkwMzY4ZWYxODkwZmU1YWFmYzIyYmYxIiwidG9rZW5fdHlwZSI6MCwidmVyaWZ5IjoxLCJyb2xlIjoxLCJpYXQiOjE3NjI2OTg4ODIsImV4cCI6MTc2MjY5OTE4Mn0.m5OrlzFwQSW96FQhLA3cFegikk8rsSJHqxoJQZsLXCo
                      refresh_token: 
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNjkwMzY4ZWYxODkwZmU1YWFmYzIyYmYxIiwidG9rZW5fdHlwZSI6MSwidmVyaWZ5IjoxLCJyb2xlIjoxLCJpYXQiOjE3NjI2OTg4ODIsImV4cCI6MTc3MTMzODg4Mn0.P7nCfb5bxmKxkI4Hn8YJzHLyMiZ0NEP_bGFw3tEoJqk
        '400':
          description: Email or password is incorrect
        '422':
          description: Validation error
  /accounts/refresh-token:
    post:
      tags:
        - Account
      summary: Refresh access token
      operationId: accountsRefreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
              required:
                - refresh_token
            example:
              refresh_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        200:
          description: Refresh token success
          content:
            application/json:
              example:
                message: "Refresh token success"
                result:
                  access_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNjkxNmUyNTA5OGQ5YzViYjk1ZDI2ZTBiIiwidG9rZW5fdHlwZSI6ImFjY2Vzc190b2tlbiIsInZlcmlmeSI6InZlcmlmaWVkIiwicm9sZV9uYW1lIjoiQWRtaW4iLCJwZXJtaXNzaW9ucyI6WyJ2aWV3X29yZGVycyIsInVwZGF0ZV9pbmdyZWRpZW50IiwiZGVsZXRlX2luZ3JlZGllbnQiLCJ2aWV3X2Rhc2hib2FyZCIsInZpZXdfc3VwcGxpZXJzIiwiZGVsZXRlX2Rpc2giLCJ1cGRhdGVfcm9sZSIsInZpZXdfaW5ncmVkaWVudHMiLCJjcmVhdGVfdGFibGUiLCJjcmVhdGVfaW5ncmVkaWVudCIsInZpZXdfdGFibGVzIiwiZGVsZXRlX3JvbGUiLCJ2aWV3X2Rpc2hfY2F0ZWdvcnlfbGlzdCIsInZpZXdfaW1wb3J0X29yZGVyX2xpc3QiLCJkZWxldGVfZGlzaF9jYXRlZ29yeSIsImNyZWF0ZV9pbmdyZWRpZW50X2NhdGVnb3J5IiwidXBkYXRlX2Rpc2hfY2F0ZWdvcnkiLCJ2aWV3X2luZ3JlZGllbnRfY2F0ZWdvcnlfbGlzdCIsInVwZGF0ZV9kaXNoIiwiY3JlYXRlX3JvbGUiLCJ1cGRhdGVfaW5ncmVkaWVudF9jYXRlZ29yeSIsImNyZWF0ZV9kaXNoIiwiZGVsZXRlX2luZ3JlZGllbnRfY2F0ZWdvcnkiLCJ2aWV3X2Rpc2hlcyIsInZpZXdfaW1wb3J0X29yZGVyX2RldGFpbCIsImRlbGV0ZV9hY2NvdW50Iiwidmlld19yb2xlcyIsInJlZ2VuZXJhdGVfdGFibGVfcXIiLCJ2aWV3X2FjY291bnRzIiwiY3JlYXRlX2Rpc2hfY2F0ZWdvcnkiLCJjcmVhdGVfYWNjb3VudCIsImRlbGV0ZV90YWJsZSIsInVwZGF0ZV9hY2NvdW50IiwiY3JlYXRlX2ltcG9ydF9vcmRlciIsInVwZGF0ZV90YWJsZSIsImNhbmNlbF9vcmRlciIsImNyZWF0ZV9zdXBwbGllciIsInVwZGF0ZV9vcmRlcl9zdGF0dXMiLCJ1cGRhdGVfc3VwcGxpZXIiLCJkZWxldGVfc3VwcGxpZXIiXSwiaWF0IjoxNzYzNTI4OTA2LCJleHAiOjE3NjM1Mjk4MDZ9.wwMR3IXblT0CBobLb3uZXdZn_uObX1On4QpXuMRgO1Y"
                  refresh_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNjkxNmUyNTA5OGQ5YzViYjk1ZDI2ZTBiIiwidG9rZW5fdHlwZSI6InJlZnJlc2hfdG9rZW4iLCJ2ZXJpZnkiOiJ2ZXJpZmllZCIsImlhdCI6MTc2MzUyODkwNiwiZXhwIjoxNzcyMTY4OTA2fQ.ZMsNR8ZEBRgSlFypHWxh2RaPx5KyaoK5n6MnPoUSYPw"
        401:
          description: Invalid token
          content:
            application/json:
              example:
                message: "Invalid token"
  /accounts/register:
    post:
      tags:
        - Account
      summary: Register a new user
      operationId: accountsRegister
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                phone:
                  type: string
                date_of_birth:
                  type: string
                  format: date-time
                role_id:
                  type: string
              required:
                - name
                - email
                - date_of_birth
                - role_id
            example:
              name: "Gao red 2"
              email: "svhn1@luxsev.com"
              phone: "0325793630"
              date_of_birth: "1999-01-20T00:00:00Z"
              role_id: "691a9a6f7800bd3806be258e"

      responses:
        200:
          description: Registration successful
          content:
            application/json:
              example:
                message: "Registration successful. Please check your email to verify your account."

        409:
          description: Email already exists
          content:
            application/json:
              example:
                message: "This email already exists"

        422:
          description: Validation error
          content:
            application/json:
              example:
                message: "Validation error"
  /accounts/logout:
    post:
      tags:
        - Account
      summary: Logout user
      operationId: accountsLogout
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
              required:
                - refresh_token
            example:
              refresh_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        200:
          description: Logout successfully
          content:
            application/json:
              example:
                message: "Logout successfully"
        401:
          description: Used refresh token or not exist
          content:
            application/json:
              example:
                message: "Used refresh token or not exist"
  /accounts/verify-email:
    post:
      tags:
        - Account
      summary: Verify user email
      operationId: verifyEmail
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email_verify_token:
                  type: string
              required:
                - email_verify_token
            example:
              email_verify_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
      responses:
        200:
          description: Email verification successful
          content:
            application/json:
              example:
                message: "Your account has been successfully verified. Please check your email to receive the password."
                code: "VERIFY_SUCCESS"
        401:
          description: Unauthorized - Token invalid or expired
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Invalid token
                  code:
                    type: string
                    example: INVALID_TOKEN
              examples:
                InvalidToken:
                  summary: Invalid token
                  value:
                    message: Invalid token
                    code: INVALID_TOKEN
                TokenExpired:
                  summary: Token expired
                  value:
                    message: Token expired, please resend
                    code: EMAIL_TOKEN_EXPIRED
  /accounts/resend-verify-email:
    post:
      tags:
        - Account
      summary: Gửi lại email xác thực (Resend Verify Email)
      description: API này sử dụng để gửi lại email xác thực dựa trên token được cung cấp.
      operationId: resendVerifyEmail
      requestBody:
        description: Thông tin cần thiết để gửi lại email xác thực
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email_verify_token:
                  type: string
                  description: Chuỗi token xác thực email (JWT). (Duy nhât ở đây khong check hạn của token)
                  example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
              required:
                - email_verify_token
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  code:
                    type: string
              examples:
                Success: # Trường hợp mới (Hình này)
                  summary: Gửi lại email thành công
                  value:
                    message: "A new verification email has been sent. Please check your inbox."
                    code: "RESEND_VERIFY_EMAIL_SUCCESS"
                AlreadyVerified: # Trường hợp cũ (Hình trước)
                  summary: Email đã được xác thực trước đó
                  value:
                    message: "This email has already been verified."
                    code: "EMAIL_ALREADY_VERIFIED"
        '401':
          description: Lỗi xác thực (Token không hợp lệ hoặc đã hết hạn).
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid token"
                  code:
                    type: string
                    example: "INVALID_TOKEN"
  /accounts/forgot-password:
    post:
      operationId: accountsForgotPassword
      tags:
        - Account
      summary: Send password reset instructions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
              required:
                - email
            example:
              email: svhn1@luxsev.com
      responses:
        200:
          description: Password reset instructions sent
          content:
            application/json:
              example:
                message: "We have sent instructions to reset your password. Please check your inbox (and spam folder) to complete the process."
        422:
          description: Validation error
  /accounts/verify-forgot-password:
    post:
      operationId: accountsVerifyForgotPassword
      tags:
        - Account
      summary: Verify forgot password token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                forgot_password_token:
                  type: string
              required:
                - forgot_password_token
            example:
              forgot_password_token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNjkxNmUyNTA5OGQ5YzViYjk1ZDI2ZTBiIiwiVG9rZW5UeXBlIjoiZm9yZ290X3Bhc3N3b3JkX3Rva2VuIiwidmVyaWZ5IjoidmVyaWZpZWQiLCJpYXQiOjE3NjM1MzAwMzksImV4cCI6MTc2NDEzNDgzOX0.f9Jx38ee-Y7KlnT3a9fC0fqye_rOVktMy1QRBskwvTE"
      responses:
        200:
          description: Verify forgot password token success
          content:
            application/json:
              example:
                message: "Verify forgot password token success"
        400:
          description: Forgot password token is required
          content:
            application/json:
              example:
                message: "Forgot password token is required."
        401:
          description: Unauthorized (Lỗi xác thực token)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  code:
                    type: string
              examples:
                TokenExpired: # Trường hợp mới (Hình này)
                  summary: Token đã hết hạn
                  value:
                    message: "Reset password token has expired. Please request a new one."
                    code: "FORGOT_PASSWORD_TOKEN_EXPIRED"
                InvalidSignature: # Trường hợp cũ (Hình trước)
                  summary: Token không hợp lệ / Chữ ký sai
                  value:
                    message: "Invalid signature"
                    code: "FORGOT_PASSWORD_TOKEN_INVALID"
  /accounts/reset-password:
    post:
      operationId: accountsResetPassword
      tags:
        - Account
      summary: Reset user password
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                forgot_password_token:
                  type: string
                password:
                  type: string
                confirm_password:
                  type: string
              required:
                - forgot_password_token
                - password
                - confirm_password
            example:
              forgot_password_token: "yJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNjkxMmFmMmU5YjJmYjFiYWIxM2QxODU4IiwiVG9rZW5UeXBlIjoiZm9yZ290X3Bhc3N3b3JkX3Rva2VuIiwidmVyaWZ5IjoidmVyaWZpZWQiLCJpYXQiOjE3NjI4MzMxMTAsImV4cCI6MTc2MzQzNzkxMH0.38A8s9fITIRbYUgk5we18NY75T4STZ6e84PBW6azsW0"
              password: "Minhnguyen123@"
              confirm_password: "Minhnguyen123@"
      responses:
        200:
          description: Password reset successfully
          content:
            application/json:
              example:
                message: "Your password has been reset successfully. You can now login with your new password."
        400:
          description: Forgot password token is required
          content:
            application/json:
              example:
                message: "Forgot password token is required."
        401:
          description: Unauthorized (Lỗi xác thực token)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  code:
                    type: string
              examples:
                TokenExpired: # Trường hợp mới (Hình này)
                  summary: Token đã hết hạn
                  value:
                    message: "Reset password token has expired. Please request a new one."
                    code: "FORGOT_PASSWORD_TOKEN_EXPIRED"
                InvalidSignature: # Trường hợp cũ (Hình trước)
                  summary: Token không hợp lệ / Chữ ký sai
                  value:
                    message: "Invalid signature"
                    code: "FORGOT_PASSWORD_TOKEN_INVALID"
        422:
          description: Validation error
          content:
            application/json:
              example:
                message: "Validation error"
  /accounts/me:
    get:
      operationId: accountsGetMe
      tags:
        - Account
      summary: Get current user profile
      security:
        - BearerAuth: []
      responses:
        200:
          description: Get my profile success
          content:
            application/json:
              example:
                message: "Get my profile success"
                result:
                  _id: "6916e25098d9c5bb95d26e0b"
                  name: "AKA Bui Hieu"
                  email: "admin1@gmail.com"
                  date_of_birth: "2025-11-16T14:26:24.000Z"
                  avatar: ""
                  role_name: "Admin"
        401:
          description: Access token is required
          content:
            application/json:
              example:
                message: "Access token is required"
    patch:
      operationId: accountsUpdateMe
      tags:
        - Account
      summary: Update my profile
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                date_of_birth:
                  type: string
                  format: date-time
                phone:
                  type: string
              example:
                name: "Ben Hiu"
                date_of_birth: "1994-10-20T00:00:00Z"
                phone: "0357371955"
      responses:
        200:
          description: Update infor success
          content:
            application/json:
              example:
                message: "Update infor success"
                result:
                  _id: "6916e25098d9c5bb95d26e0b"
                  name: "Ben Hiu"
                  date_of_birth: "1994-10-20T00:00:00.000Z"
                  phone: "0357371955"
        401:
          description: Invalid signature
          content:
            application/json:
              example:
                message: "Invalid signature"
        422:
          description: Validation error
  /accounts/change-password:
    post:
      operationId: accountsChangePassword
      tags:
        - Account
      summary: Change user password
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                old_password:
                  type: string
                password:
                  type: string
                confirm_password:
                  type: string
              required:
                - old_password
                - password
                - confirm_password
            example:
              old_password: "MinhNguyen123@"
              password: "MinhOkela123#@1"
              confirm_password: "MinhOkela123#@1"
      responses:
        200:
          description: Password changed successfully
          content:
            application/json:
              example:
                message: "Your password has been changed successfully."
        401:
          description: Old password is not correct
          content:
            application/json:
              example:
                message: "Your old password is not correct."
        422:
          description: Validation error
          content:
            application/json:
              example:
                message: "Validation error"
  /accounts:
    get:
      operationId: accountsGetList
      tags:
        - Account
      summary: Get list of accounts with pagination and filters
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Number of items per page
        - in: query
          name: search
          schema:
            type: string
          description: Search by name or email
        - in: query
          name: roleId
          schema:
            type: string
          description: Filter by role ID
      responses:
        200:
          description: Get list of accounts successfully
          content:
            application/json:
              example:
                message: "Get list of accounts successfully"
                result:
                  accounts:
                    - _id: "691d4ed71b4f49cdadc0dc06"
                      name: "Gao red 2"
                      email: "nhanvien2+3@gmail.com"
                      date_of_birth: "1999-01-20T00:00:00.000Z"
                      avatar: ""
                      role_name: "Employee"
                    - _id: "691c91d732db64f4a94babf9"
                      name: "Gao red 2"
                      email: "nhanvien2+2@gmail.com"
                      date_of_birth: "1999-01-20T00:00:00.000Z"
                      avatar: ""
                      role_name: "Employee"
                    - _id: "691c8fa12d5a0b22275915d1"
                      name: "Gao red 2"
                      email: "nhanvien2+1@gmail.com"
                      date_of_birth: "1999-01-20T00:00:00.000Z"
                      avatar: ""
                      role_name: "Employee"
                    - _id: "691c89dff02889e3344bb0ea"
                      name: "Gao red 2"
                      email: "nhanvien2@gmail.com"
                      date_of_birth: "1999-01-20T00:00:00.000Z"
                      avatar: ""
                      role_name: "Employee"
                    - _id: "691a9abf7800bd3806be258f"
                      name: "Gao red"
                      email: "nhanvien1@gmail.com"
                      date_of_birth: "1999-01-20T00:00:00.000Z"
                      avatar: ""
                      role_name: "Employee"
                    - _id: "6916e25098d9c5bb95d26e0b"
                      name: "AKA Bui Hieu"
                      email: "admin1@gmail.com"
                      date_of_birth: "2025-11-16T14:26:24.000Z"
                      avatar: ""
                      role_name: "Admin"
                  pagination:
                    currentPage: 1
                    limit: 10
                    total: 6
                    totalPages: 1
        401:
          description: Invalid signature
          content:
            application/json:
              example:
                message: "Invalid signature"
  /accounts/me/avatar:
    patch:
      operationId: updateAvatar
      tags:
        - Account
      summary: Upload avatar
      description: Update avatar using multipart/form-data
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
              required:
                - image
            example:
              image: (binary)
      responses:
        200:
          description: Avatar updated successfully
          content:
            application/json:
              example:
                message: "Avatar updated successfully"
                result:
                  avatar: "https://res.cloudinary.com/dpmbhsbcg/image/upload/v1763567455/restaurant-app/img_1763567454472.jpg"
        400:
          description: No image uploaded
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: No image uploaded
        401:
          description: Invalid signature
          content:
            application/json:
              example:
                message: "Invalid signature"
  /accounts/{id}:
    patch:
      tags:
        - Account 
      summary: Update an account (Admin only)
      description: Admin can update account's status or role.
      operationId: updateAccount
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Account ID (MongoDB ObjectId)

      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  description: Account status
                  example: active
                role_id:
                  type: string
                  description: New role ID
                  example: "6912ad761ef6eba42b035370"

      responses:
        200:
          description: Account updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Account updated successfully
        403:
          description: Forbidden – User does not have permission
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Forbidden
        404:
          description: Role not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Role not found

  /tables:
    post:
        tags:
          - Table
        summary: Tạo mới tables
        description: Tạo mới tables
        operationId: createTable
        requestBody:
          description: Thông tin tạo mới table
          content:
            application/json:
              schema:
                type: object
                properties:
                  capacity:
                    type: number
                    example: 8
          required: true
        security:
          - BearerAuth: []
        responses:
          '200':
            description: successful operation
            content:
              application/json:
                schema:
                  type: object
                  properties:
                    message: 
                      type: string
                      example: Table created successfully.
                    result: 
                      type: object
                      example:
                        QRcode:
                          type: string
                          example: "data:image/png;base64,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"
                        table: 
                          type: object
                          properties:
                            id:
                              type: string
                              format: MongoId
                              example: 69114df7111e533f4e76600e
                            number:
                              type: integer
                              example: 9
                            capacity:
                              type: integer
                              example: 12
                            status:
                              type: integer
                              example: 0
                            currentOrderId:
                              type: string
                              nullable: true
                              example: null
                            createdAt:
                              type: string
                              format: date-time
                              example: 2025-11-10T02:29:11.676Z
                            updatedAt:
                              type: string
                              format: date-time
                              example: 2025-11-10T02:29:11.676Z
          '401':
            description: Access token is required
          '422':
            description: Validation error
    get:
      tags:
        - Table
      summary: Lấy danh sách bàn
      description: Lấy danh sách bàn bao gồm phân trang và lọc theo trạng thái (Sử dụng 0, 1, 2, 3 tương ứng với Available, Occupied, Reserved, Needs_cleaning)
      operationId: getAllTable
      parameters:
        - name: page
          in: query
          description: Phân trang
          required: false
          schema:
            type: string
        - name: status
          in: query
          description: Tìm kiếm theo trạng thái bàn
          required: false
          schema:
            type: number

      security:
        - BearerAuth: []
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: 
                    type: string
                    example: "Get all tables successfully."
                  tables: 
                    type: array
                    description: Danh sách các bàn
                    items:
                      $ref: '#/components/schemas/Table'
                  currentPage:
                    type: integer
                    description: Trang hiện tại
                    example: 1
                  limit:
                    type: integer
                    description: Số lượng bàn trên mỗi trang
                    example: 4
                  skip:
                    type: integer
                    description: Số lượng bàn đã bỏ qua
                    example: 0
                  totalPage:
                    type: integer
                    description: Tổng số trang
                    example: 3
        '401':
          description: Access token is required
        '422':
          description: Validation error
  /tables/{id}:
    patch:
      tags:
        - Table
      summary: Cập nhật thông tin bàn
      description: Cập nhật thông tin bàn (Hiện tại là Số ghế và trạng thái)
      operationId: updateTable
      parameters:
        - name: id
          in: path
          description: Id của bàn cập nhật
          required: true
          schema:
            type: string
            format: MongoId
            example: "6908bd8b93418ddd670d7098" 
      requestBody:
        description: Các trường cần cập nhật. Bạn có thể gửi 1 trong 2 trường, hoặc cả 2.
        required: true # Bản thân object body là bắt buộc, nhưng các trường bên trong là không
        content:
          application/json:
            schema:
              # Tham chiếu đến một schema mới ta sẽ tạo ở bước 2
              $ref: '#/components/schemas/UpdateTableRequest'

      security:
        - BearerAuth: []
      responses:
        '200':
          description: Cập nhật bàn thành công. Trả về thông tin bàn đã được cập nhật.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Table' 
        '400':
          description: Dữ liệu gửi lên không hợp lệ
        '401':
          description: Lỗi xác thực (chưa đăng nhập hoặc không có quyền)
        '404':
          description: Không tìm thấy bàn với ID được cung cấp
  /tables/{id}/qr-token:
    patch:
      tags:
        - Table
      summary: Thay đổi mã QRCode
      description: Thay đổi qrToken -> thay đổi QRCode
      operationId: regenerateQrToken
      parameters:
        - name: id
          in: path
          description: Id của bàn cập nhật
          required: true
          schema:
            type: string
            format: MongoId
            example: "6908bd8b93418ddd670d7098" 
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Cập nhật bàn thành công. Trả về thông tin bàn đã được cập nhật.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: 
                    type: string
                    example: "QR token regenerated successfully."
                  table:
                    type: object
                    properties:
                      orderUrl: 
                        type: string
                        example: "https://your-app-frontend.com/order?token=0d1b932af96cc87a3e575e0cfbb1aba7dba64713"
                      QRtable: 
                        type: string
                        example: "data:image/png;base64,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"

        '400':
          description: Dữ liệu gửi lên không hợp lệ
        '401':
          description: Lỗi xác thực (chưa đăng nhập hoặc không có quyền)
        '404':
          description: Không tìm thấy bàn với ID được cung cấp
  
  # Đã xong
  /suppliers:
    get:
      tags:
        - Supplier
      summary: Get All Suppliers
      operationId: getAllSuppliers
      security:
        - BearerAuth: []
      parameters:
        - name: search
          in: query
          schema:
            type: string
          description: Tìm kiếm theo tên nhà cung cấp, email, người liên hệ hoặc số điện thoại.
          example: "3510"
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive]
          description: Lọc theo trạng thái
          example: "active"
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Trang hiện tại
          example: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 5
          description: Số lượng bản ghi trên một trang
          example: 5
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get all suppliers success"
                  result:
                    type: object
                    properties:
                      suppliers:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              example: "69255e74949ebf8ff555f500"
                            name:
                              type: string
                              example: "Cup cấp gạo"
                            taxCode:
                              type: string
                              example: "TX12345633"
                            status:
                              type: string
                              example: "active"
                            contactPerson:
                              type: string
                              example: "Hồng Hạnh"
                            phone:
                              type: string
                              example: "+84327593510"
                            email:
                              type: string
                              example: "contact@honghanhtextile.com"
                            address:
                              type: string
                              example: "123 Nguyen Trai Street, District 5, Ho Chi Minh City"
                      pagination:
                        type: object
                        properties:
                          currentPage:
                            type: integer
                            example: 1
                          limit:
                            type: integer
                            example: 5
                          total:
                            type: integer
                            example: 1
                          totalPage:
                            type: integer
                            example: 1
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
    post:
      tags:
        - Supplier
      summary: Create Supplier
      operationId: createSupplier
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 50
                  example: "Cung cấp gạo"
                taxCode:
                  type: string
                  minLength: 5
                  maxLength: 20
                  description: Chỉ chứa chữ và số
                  example: "TX12345633"
                status:
                  type: string
                  enum: [active, inactive]
                  example: "active"
                contactPerson:
                  type: string
                  example: "Hồng Hạnh"
                phone:
                  type: string
                  example: "+84327593510"
                email:
                  type: string
                  format: email
                  example: "contact@honghanhtextile.com"
                address:
                  type: string
                  example: "123 Nguyen Trai Street, District 5, Ho Chi Minh City"
              required:
                - name
                - taxCode
                - status
                - contactPerson
                - phone
                - email
                - address
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Supplier created successfully."
                  result:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "69255e74949ebf8ff555f500"
                      name:
                        type: string
                        example: "Cup cấp gạo"
                      taxCode:
                        type: string
                        example: "TX12345633"
                      status:
                        type: string
                        example: "active"
                      contactPerson:
                        type: string
                        example: "Hồng Hạnh"
                      phone:
                        type: string
                        example: "+84327593510"
                      email:
                        type: string
                        example: "contact@honghanhtextile.com"
                      address:
                        type: string
                        example: "123 Nguyen Trai Street, District 5, Ho Chi Minh City"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
        '422':
          description: Unprocessable Entity (Validation Error)
          content:
            application/json:
              schema:
                type: object
              examples:
                TaxCodeError:
                  summary: Tax Code sai định dạng/độ dài
                  value:
                    message: "Validation error"
                    errors:
                      taxCode: "Tax code length must be between 5 and 20 characters"
                EmailError:
                  summary: Email không hợp lệ
                  value:
                    message: "Validation error"
                    errors:
                      email: "Email is invalid"
  /suppliers/{supplier_id}:
    patch:
      tags:
        - Supplier
      summary: Update Supplier
      operationId: updateSupplier
      security:
        - BearerAuth: []
      parameters:
        - name: supplier_id
          in: path
          required: true
          schema:
            type: string
          description: ID của nhà cung cấp cần cập nhật
          example: "69255e74949ebf8ff555f500"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 50
                  example: "Cup cấp gạo"
                taxCode:
                  type: string
                  minLength: 5
                  maxLength: 20
                  example: "TX12345679"
                status:
                  type: string
                  enum: [active, inactive]
                  example: "active"
                contactPerson:
                  type: string
                  example: "Hồng Hạnh"
                phone:
                  type: string
                  example: "+84981239876"
                email:
                  type: string
                  format: email
                  example: "contact@honghanhtextile.com"
                address:
                  type: string
                  example: "123 Nguyen Trai Street, District 5, Ho Chi Minh City"
              # Không có key 'required' vì các trường đều là optional
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Supplier updated successfully."
                  result:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "69255e74949ebf8ff555f500"
                      name:
                        type: string
                        example: "Cup cấp gạo"
                      taxCode:
                        type: string
                        example: "TX12345633"
                      status:
                        type: string
                        example: "active"
                      contactPerson:
                        type: string
                        example: "Hồng Hạnh"
                      phone:
                        type: string
                        example: "+84327593510"
                      email:
                        type: string
                        example: "contact@honghanhtextile.com"
                      address:
                        type: string
                        example: "123 Nguyen Trai Street, District 5, Ho Chi Minh City"
        '400':
          description: Bad Request (ID không hợp lệ)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid MongoDB Id format"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
        '404':
          description: Not Found (Không tìm thấy nhà cung cấp)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Supplier not found"
        '422':
          description: Unprocessable Entity (Validation Error - Dữ liệu gửi lên không đúng quy định)
          content:
            application/json:
              schema:
                type: object
              examples:
                InvalidFormat:
                  summary: Sai định dạng (Email/Phone)
                  value:
                    message: "Validation error"
                    errors:
                      email: "Email is invalid"
                      phone: "Phone number is invalid"
                InvalidValue:
                  summary: Sai giá trị (TaxCode/Status)
                  value:
                    message: "Validation error"
                    errors:
                      taxCode: "Tax code length must be between 5 and 20 characters"
                      status: "Status must be active or inactive"
    delete:
      tags:
        - Supplier
      summary: Delete Supplier
      operationId: deleteSupplier
      security:
        - BearerAuth: []
      parameters:
        - name: supplier_id
          in: path
          required: true
          schema:
            type: string
          description: ID của nhà cung cấp cần xóa
          example: "69255e74949ebf8ff555f500"
      responses:
        '200':
          description: OK (Xóa thành công)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Delete supplier successfully."
        '400':
          description: Bad Request (ID sai định dạng)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "The provided ID is not a valid MongoDB ObjectId format."
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
        '404':
          description: Not Found (Không tìm thấy nhà cung cấp)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Supplier not found"
  
  /permissions:
    post:
      tags:
          - Permission
      summary: Tạo mới quyền
      description: Tạo mới quyền
      operationId: createPermission
      requestBody:
        description: Thông tin tạo mới quyền
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/createPermissionReqBody'
        required: true
      security:
        - BearerAuth: [] 
      responses:
        '200':
          description: successful operation
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: 
                    type: string
                    example: "Create permission successfully."
                  result: 
                    type: object
                    description: Quyền vừa được tạo mới
                    $ref: '#/components/schemas/Permission'
        '401':
          description: Access token is required
        '422':
          description: Validation error
    get:
      tags:
        - Permission
      summary: Get all permissions
      description: Lấy danh sách tất cả quyền trong hệ thống.
      operationId: getAllPermission
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Get all permissions success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Get all permissions success
                  result:
                    type: array
                    items:
                      $ref: "#/components/schemas/Permission"
  /permission/{permission_id}:
    put:
      tags:
        - Permission
      summary: Update a permission
      description: Cập nhật thông tin của một quyền.
      operationId: changePermiison
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID của permission cần cập nhật
          schema:
            type: string
            example: 6915916c7d31b24b66fd0c14
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdatePermissionReqBody"
            example:
              name: create_table
              description: Create a new table in the restaurant.
              module: table
      responses:
        "200":
          description: Update permission successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Update permission successfully.
                  result:
                    $ref: "#/components/schemas/Permission"
              example:
                message: Update permission successfully.
                result:
                  _id: 6915916c7d31b24b66fd0c14
                  name: create_table
                  description: Create a new table in the restaurant.
                  module: table
    delete:
      tags:
        - Permission
      summary: Delete a permission
      description: Xóa một quyền theo ID.
      operationId: deletePermiison
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID của permission cần xóa
          schema:
            type: string
            example: 6915916c7d31b24b66fd0c14
      responses:
        "200":
          description: Delete permission successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Delete permission successfully
              example:
                message: Delete permission successfully
        '400':
          description: The provided ID is not a valid MongoDB ObjectId format.
        '401':
          description: Access token is required
        '404':
          description: Permiission not found

  /roles: 
    post:
      tags:
        - Role
      summary: Create a new role
      description: Tạo một vai trò mới với danh sách quyền.
      operationId: createRole
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateRoleReqBody"
            example:
              name: Employee 1
              description: ""
              status: active
              permissionIds: ["6915915c7d31b24b66fd0c13","6915917c7d31b24b66fd0c15"]
      responses:
        "201":
          description: Create role successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Create role successfully.
                  result:
                    $ref: "#/components/schemas/Role"
              example:
                message: Create role successfully.
                result:
                  _id: 691aa3757800bd3806be2595
                  name: Employee 1
                  description: ""
                  status: active
                  permissionIds: ["6915915c7d31b24b66fd0c13","6915917c7d31b24b66fd0c15"]
    get:
      tags:
        - Role
      summary: Get all roles
      description: Lấy danh sách tất cả vai trò, kèm chi tiết quyền.
      operationId: getAllRoles
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Get all roles successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Get all roles successfully.
                  result:
                    type: array
                    items:
                      $ref: "#/components/schemas/RoleWithPermissions"
              example:
                message: Get all roles successfully.
                result:
                  - _id: 6911a5cbd2c16ce645a813a0
                    name: Admin
                    description: Admin's permissions
                    status: active
                    permissions:
                      - _id: 691593007d31b24b66fd0c2d
                        name: update_role
                        module: role
                      - _id: 6915918d7d31b24b66fd0c16
                        name: delete_table
                        module: table
                  - _id: 691a9a6f7800bd3806be258e
                    name: Employee
                    description: ""
                    status: active
                    permissions: []
                  - _id: 691aa3757800bd3806be2595
                    name: Employee 1
                    description: ""
                    status: active
                    permissions: []
  /roles/{role_id}:
    put:
      operationId: updateRole
      tags:
        - Role
      summary: Update a role
      description: Cập nhật thông tin của một role, bao gồm danh sách permissionIds.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID của role cần update
          schema:
            type: string
            example: 6911a5cbd2c16ce645a813a0
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateRoleReqBody"
            example:
              name: Admin
              description: Admin's permissions
              status: active
              permissionIds: [
                "6915919f7d31b24b66fd0c17",
                "6915915c7d31b24b66fd0c13",
                "6915917c7d31b24b66fd0c15"
              ]
      responses:
        "200":
          description: Update role successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Update role successfully.
                  result:
                    $ref: "#/components/schemas/Role"
              example:
                message: Update role successfully.
                result:
                  _id: 6911a5cbd2c16ce645a813a0
                  name: Admin
                  description: Admin's permissions
                  status: active
                  permissionIds: [
                    "6915919f7d31b24b66fd0c17",
                    "6915915c7d31b24b66fd0c13",
                    "6915917c7d31b24b66fd0c15",
                    "6915918d7d31b24b66fd0c16",
                    "6915916c7d31b24b66fd0c14",
                    "691592587d31b24b66fd0c23",
                    "691592807d31b24b66fd0c25",
                  ]
    delete:
      operationId: deleteRole
      tags:
        - Role
      summary: Delete a role
      description: Xóa một role theo ID.
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: ID của role cần xóa
          schema:
            type: string
            example: 691aa3757800bd3806be2595
      responses:
        "200":
          description: Delete role successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Delete role successfully.
              example:
                message: Delete role successfully.
  
  /ingredients:
    post:
      tags:
        -  Ingredient
      summary: Create Ingredient
      operationId: createIngredient
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  minLength: 2
                  description: Tên nguyên liệu (tối thiểu 2 ký tự)
                  example: "Thịt heo"
                categoryId:
                  type: string
                  description: MongoID của danh mục
                  example: "69254fee3b367e7f37bfff12"
                unit:
                  type: string
                  description: Đơn vị tính (kg, lít, cái...)
                  example: "kg"
                minStock:
                  type: integer
                  minimum: 1
                  description: Mức tồn kho tối thiểu (phải > 0)
                  example: 20
                supplierIds:
                  type: array
                  description: Danh sách ID các nhà cung cấp (Optional)
                  items:
                    type: string
                    example: "69255cd36d1d50a5f158f868"
                  example: ["69255cd36d1d50a5f158f868", "6926c6a7349187bd6ac5f21c"]
              required:
                - name
                - categoryId
                - unit
                - minStock
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Ingredient created successfully."
                  result:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "6927fb42cf4d3b71b47c5938"
                      name:
                        type: string
                        example: "Thịt heo"
                      categoryId:
                        type: string
                        example: "69254fee3b367e7f37bfff12"
                      unit:
                        type: string
                        example: "kg"
                      unitPrice:
                        type: number
                        description: Giá mặc định là 0 khi tạo mới
                        example: 0
                      supplierIds:
                        type: array
                        items:
                          type: string
                        example: []
                      currentStock:
                        type: integer
                        example: 0
                      minStock:
                        type: integer
                        example: 20
        '400':
          description: Bad Request (Lỗi định dạng Category ID)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Category ID is invalid"
                  status:
                    type: integer
                    example: 400
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
        '422':
          description: Unprocessable Entity (Validation Error)
          content:
            application/json:
              schema:
                type: object
              examples:
                InvalidData:
                  summary: Dữ liệu không hợp lệ
                  value:
                    message: "Validation error"
                    errors:
                      name: "Ingredient name must be at least 2 chars"
                      minStock: "Min stock must be a positive integer"
                      supplierIds: "Array contains invalid Supplier ID"
    get:
      tags:
        - Ingredient
      summary: Get All Ingredients
      operationId: getAllIngredients
      security:
        - BearerAuth: []
      parameters:
        - name: search
          in: query
          schema:
            type: string
          description: Tìm kiếm theo tên nguyên liệu
          example: "thịt"
        - name: status
          in: query
          schema:
            type: string
            enum: [in_stock, low_stock, out_of_stock]
          description: |
            Lọc theo trạng thái tồn kho:
            - in_stock: Còn hàng (currentStock > minStock)
            - low_stock: Sắp hết (0 < currentStock <= minStock)
            - out_of_stock: Hết hàng (currentStock = 0)
          example: "in_stock"
        - name: supplierId
          in: query
          schema:
            type: string
          description: Lọc theo ID nhà cung cấp
          example: "6925d6a45b616421690a7150"
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Trang hiện tại
        - name: limit
          in: query
          schema:
            type: integer
            enum: [10, 15, 20]
            default: 10
          description: Số lượng bản ghi trên một trang (chỉ chấp nhận 10, 15 hoặc 20)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Ingredients retrieved successfully"
                  result:
                    type: object
                    properties:
                      ingredients:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              example: "6927fb42cf4d3b71b47c5938"
                            name:
                              type: string
                              example: "Thịt heo"
                            unit:
                              type: string
                              example: "kg"
                            unitPrice:
                              type: number
                              example: 0
                            currentStock:
                              type: integer
                              example: 0
                            minStock:
                              type: integer
                              example: 20
                            categoryName:
                              type: string
                              example: "Meat"
                            supplierNames:
                              type: array
                              items:
                                type: object
                                properties:
                                  _id:
                                    type: string
                                    example: "69255cd36d1d50a5f158f868"
                                  name:
                                    type: string
                                    example: "Cung cấp thịt"
                      pagination:
                        type: object
                        properties:
                          currentPage:
                            type: integer
                            example: 1
                          limit:
                            type: integer
                            example: 10
                          total:
                            type: integer
                            example: 1
                          totalPage:
                            type: integer
                            example: 1
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
  /ingredients/{id}:
    patch:
      tags:
        - Ingredient
      summary: Update Ingredient
      operationId: updateIngredient
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID của nguyên liệu cần cập nhật
          example: "6927fb42cf4d3b71b47c5938"
      requestBody:
        description: Chỉ cho phép cập nhật Category, MinStock và SupplierIDs
        content:
          application/json:
            schema:
              type: object
              properties:
                categoryId:
                  type: string
                  description: MongoID của danh mục mới
                  example: "69254fee3b367e7f37bfff12"
                minStock:
                  type: integer
                  minimum: 0
                  description: Mức tồn kho tối thiểu mới
                  example: 10
                supplierIds:
                  type: array
                  description: Danh sách ID nhà cung cấp mới
                  items:
                    type: string
                  example: ["69255cd36d1d50a5f158f868"]
              # Các trường là optional, không bắt buộc gửi hết
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Ingredient updated successfully."
                  data: # Chú ý: Key này là data theo ảnh Postman
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "6927fb42cf4d3b71b47c5938"
                      name:
                        type: string
                        example: "Thịt heo"
                      unit:
                        type: string
                        example: "kg"
                      unitPrice:
                        type: number
                        example: 0
                      currentStock:
                        type: integer
                        example: 0
                      minStock:
                        type: integer
                        example: 10
                      categoryName:
                        type: string
                        example: "Meat"
                      suppliers:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "69255cd36d1d50a5f158f868"
                            name:
                              type: string
                              example: "Cung cấp thịt"
        '400':
          description: Bad Request (ID không hợp lệ)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid MongoDB Id format"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Ingredient not found"
        '422':
          description: Unprocessable Entity (Validation Error)
          content:
            application/json:
              schema:
                type: object
              examples:
                InvalidData:
                  summary: Dữ liệu không hợp lệ
                  value:
                    message: "Validation error"
                    errors:
                      minStock: "Min stock must be a positive integer"
                      categoryId: "Category ID is invalid"
    delete:
      tags:
        - Ingredient
      summary: Delete Ingredient
      operationId: deleteIngredient
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID của nguyên liệu cần xóa
          example: "6927fb42cf4d3b71b47c5938"
      responses:
        '200':
          description: OK (Xóa thành công)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Delete ingredient successfully"
        '400':
          description: Bad Request (ID sai định dạng)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid MongoDB Id format"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
        '404':
          description: Not Found (Không tìm thấy nguyên liệu)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Ingredient not found"
  
  /import-orders:
    post:
      tags:
        - Import Orders
      summary: Create a new import order
      operationId: createImportOrder
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                supplierId:
                  type: string
                status:
                  $ref: "#/components/schemas/ImportOrderStatus"
                importDate:
                  type: string
                  format: date
                items:
                  type: array
                  items:
                    type: object
                    properties:
                      ingredientId:
                        type: string
                      quantity:
                        type: number
                      importPrice:
                        type: number

                taxRate:
                  type: number
                  description: Optional tax rate (%)
                  example: 5

                notes:
                  type: string
                  description: Optional notes for the import order
                  example: "Hàng giao buổi sáng"

              required:
                - supplierId
                - importDate
                - items

            example:
              supplierId: "690dad4474beb3c7ee4df922"
              importDate: "2025-11-17"
              status: "confirmed"
              items:
                - ingredientId: "691ae1a9885a522575e5a0ad"
                  quantity: 10
                  importPrice: 5.5
                - ingredientId: "690dad4474beb3c7ee4df922"
                  quantity: 100
                  importPrice: 2.5
              taxRate: 5
              notes: "Hàng giao buổi sáng"

              

      responses:
        201:
          description: Import order created
          content:
            application/json:
              example:
                message: "Import order created successfully"

    get:
      tags:
        - Import Orders
      summary: Get list of import orders
      operationId: getImportOrders
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
            example: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
            example: 10
        - in: query
          name: search
          schema:
            type: string
            example: "B1WG"
        - in: query
          name: status
          schema:
            $ref: "#/components/schemas/ImportOrderStatus"
          example: confirmed
        - in: query
          name: supplierId
          schema:
            type: string
            example: "690dad4474beb3c7ee4df922"
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
            example: "2025-11-16"
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
            example: "2025-11-20"

      responses:
        200:
          description: List of import orders
          content:
            application/json:
              example:
                message: "Import orders retrieved successfully"
                data:
                  importOrders:
                    - _id: "691b2f06c8ffd89b56cfa46e"
                      orderNumber: "PO-20251117-RCMN"
                      importDate: "2025-11-16T17:00:00.000Z"
                      status: "confirmed"
                      items:
                        - ingredientId: "691ae1a9885a522575e5a0ad"
                          ingredientName: "Thit bo"
                          quantity: 10
                          importPrice: 5.5
                          total: 55
                      subtotal: 55
                      taxRate: 5
                      taxAmount: 2.75
                      totalAmount: 57.75
                      supplierName: "Hieu Bui 234"
                      importedByName: "Gao red"
                  pagination:
                    currentPage: 1
                    limit: 10
                    total: 1
                    totalPages: 1
  /import-orders/{id}:
    get:
      tags:
        - Import Orders
      summary: Get import order detail
      operationId: getImportOrderDetail
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          example: "691b2ed8c8ffd89b56cfa46d"

      responses:
        200:
          description: Import order detail
          content:
            application/json:
              example:
                message: "Import order detail retrieved successfully"
                data:
                  _id: "691b2ed8c8ffd89b56cfa46d"
                  orderNumber: "PO-20251117-1I97"
                  importDate: "2025-11-16T17:00:00.000Z"
                  status: "confirmed"
                  items:
                    - ingredientId: "690dad4474beb3c7ee4df922"
                      ingredientName: "Gạo ST25"
                      quantity: 100
                      importPrice: 2.5
                      total: 250
                      unit: "kg"
                    - ingredientId: "691ae1a9885a522575e5a0ad"
                      ingredientName: "Thit bo"
                      quantity: 10
                      importPrice: 4.5
                      total: 45
                      unit: "kg"
                  subtotal: 295
                  taxRate: 5
                  taxAmount: 14.75
                  totalAmount: 309.75
                  notes: "Hàng giao buổi sáng"
                  importedByName: "Gao red"
                  supplierName: "Hieu Bui 234"

  # Đã xong
  /categories:
    get:
      tags:
        - Category Ingredient
      summary: Get All Categories ingredient
      description: Lấy danh sách danh mục nguyên liệu có hỗ trợ phân trang và tìm kiếm.
      operationId: getAllCategories
      security:
        - BearerAuth: []
      parameters:
        - name: search
          in: query
          schema:
            type: string
          description: Từ khóa tìm kiếm (tên danh mục)
          example: "a v"
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive]
          description: Lọc theo trạng thái (active/inactive)
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Trang hiện tại
        - name: limit
          in: query
          schema:
            type: integer
            default: 5
          description: Số lượng bản ghi trên một trang, cho phép [5, 10, 15]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get all categories success"
                  result:
                    type: object
                    properties:
                      categories:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              example: "672551d4b130bafac43d0559"
                            name:
                              type: string
                              example: "Gia vị"
                            description:
                              type: string
                              example: "Category gia vị."
                            status:
                              type: string
                              example: "active"
                      pagination:
                        type: object
                        properties:
                          currentPage:
                            type: integer
                            example: 1
                          limit:
                            type: integer
                            example: 10
                          total:
                            type: integer
                            example: 1
                          totalPage:
                            type: integer
                            example: 1
    post:
      tags:
        - Category Ingredient
      summary: Create Category
      operationId: createCategory
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Gia vị 1"
                description:
                  type: string
                  example: "Category gia vị."
                status:
                  type: string
                  enum: [active, inactive]
                  example: "active"
              required:
                - name
                - description
                - status
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Category created successfully."
                  result:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "6925543f81f594b4d5983acd"
                      name:
                        type: string
                        example: "Gia vị 1"
                      description:
                        type: string
                        example: "Category gia vị."
                      status:
                        type: string
                        example: "active"
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Validation error"
                  errors:
                    type: object # Hoặc array tùy middleware format lỗi của bạn
              examples:
                MissingFields:
                  summary: Thiếu trường bắt buộc
                  value:
                    message: "Validation error"
                    errors:
                      name: "Name is required"
                      status: "Status is required"
                InvalidEnum:
                  summary: Sai giá trị Status
                  value:
                    message: "Validation error"
                    errors:
                      status: "Status must be active or inactive"
                InvalidLength:
                  summary: Sai độ dài Name/Description
                  value:
                    message: "Validation error"
                    errors:
                      name: "Name length must be between 1 and 50"
  /categories/{id}:
    patch:
      tags:
        - Category Ingredient
      summary: Update Category
      operationId: updateCategory
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID của danh mục cần cập nhật
          example: "69254fee3b367e7f37bfff12"
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  example: "Meat"
                description:
                  type: string
                  example: "Category meat"
                status:
                  type: string
                  enum: [active, inactive]
                  example: "inactive"
              # Các trường đều là optional nên không có key 'required' ở đây
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Category updated successfully."
                  result:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "69254fee3b367e7f37bfff12"
                      name:
                        type: string
                        example: "Meat"
                      description:
                        type: string
                        example: "Category meat"
                      status:
                        type: string
                        example: "inactive"
        '400':
          description: Bad Request (Sai định dạng ID)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid MongoDB Id format" # Message từ USER_MESSAGES.INVALID_MONGODB_ID_FORMAT
        '422':
          description: Validation Error (Dữ liệu body sai)
          content:
            application/json:
              schema:
                type: object
              examples:
                InvalidBody:
                  summary: Dữ liệu gửi lên không hợp lệ
                  value:
                    message: "Validation error"
                    errors:
                      name: "Name must be a string"
                      status: "Status must be active or inactive"

  /dishes:
    post:
      tags:
        - Dishes
      summary: Create a new dish
      operationId: createDish
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: File ảnh của món ăn (jpg, png, webp)
                name:
                  type: string
                  description: Tên món ăn
                  example: "Cánh gà chiên mắm (4 chiếc)"
                price:
                  type: number
                  description: Giá bán
                  example: 85000
                description:
                  type: string
                  description: Mô tả món ăn
                  example: "Cánh gà chiên nước mắm đậm đà, da giòn."
                status:
                  type: string
                  enum:
                    - available
                    - unavailable
                    - hidden
                  default: available
                  description: Trạng thái kinh doanh
                categoryId:
                  type: string
                  description: ObjectId của danh mục món ăn
                  example: "692cf1c2e2c4e6ad4964e8a2"
                isFeatured:
                  type: boolean
                  default: false
                  description: Đánh dấu là món nổi bật
                  example: true
                recipe:
                  type: string
                  description: 'Chuỗi JSON đại diện cho mảng công thức. Bắt buộc format: [{"ingredientId": "...", "quantity": ...}]'
                  example: '[{"ingredientId": "692cf2c3e2c4e6ad4964e8a3", "quantity": 0.4}]'
              required:
                - name
                - description
                - price
                - image
                - status
                - categoryId
                - recipe
              
      responses:
        '201':
          description: Dish created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Dish created successfully"
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                      name:
                        type: string
                      price:
                        type: number
                      description:
                        type: string
                      image:
                        type: string
                      status:
                        type: string
                      categoryId:
                        type: string
                      isFeatured:
                        type: boolean
                      recipe:
                        type: array
                        items:
                          type: object
                          properties:
                            ingredientId:
                              type: string
                            quantity:
                              type: number
              example:
                message: "Dish created successfully"
                data:
                  _id: "692cf98aa018b5563c300239"
                  name: "Cánh gà chiên mắm (8 chiếc)"
                  price: 85000
                  description: "Cánh gà chiên nước mắm đậm đà, da giòn."
                  image: "https://res.cloudinary.com/dpmbhsbcg/image/upload/v1764555144/restaurant-app/img_1764555142678.jpg"
                  status: "available"
                  categoryId: "692ceff06e1be3877b5ec4b3"
                  recipe:
                    - ingredientId: "692cf42ee2c4e6ad4964e8a5"
                      quantity: 0.8
                  isFeatured: false
                
        '400':
          description: Lỗi Logic Nghiệp vụ (Business Logic Errors)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Nội dung thông báo lỗi chi tiết
              examples:
                
                CategoryNotFound:
                  summary: Danh mục không tồn tại
                  value:
                    message: "Dish category not found"

                CategoryInactive:
                  summary: Danh mục đang bị khóa
                  value:
                    message: "Dish category is currently inactive"

                InvalidRecipeJson:
                  summary: Recipe sai định dạng JSON
                  value:
                    message: "Recipe must be a valid JSON string (Array of objects)"

                DuplicateIngredient:
                  summary: Trùng lặp nguyên liệu
                  value:
                    message: "Recipe contains duplicate ingredients. Please merge them."

                InvalidIngredients:
                  summary: Nguyên liệu không hợp lệ
                  value:
                    message: "Validation failed for ingredients. The following IDs are either non-existent or deleted: [654a..., 654b...]"

                InvalidImage:
                  summary: Ảnh không hợp lệ hoặc thiếu
                  value:
                    message: "File type not supported (only .jpg, .jpeg, .png, .webp)"

        '422':
          description: Lỗi Validation Dữ liệu (Input Validation Errors)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  errors:
                    type: object
              examples:
                # Trường hợp thiếu trường hoặc sai kiểu dữ liệu
                ValidationError:
                  summary: Dữ liệu đầu vào sai
                  value:
                    message: "Validation error"
                    errors:
                      price:
                        msg: "Dish price must be a number"
                        value: "abc"
                      recipe:
                        msg: "Dish recipe must be an array"
                        value: "..."
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (Không có quyền create_dish)
    get:
      tags:
        - Dishes
      summary: Lấy danh sách món ăn (Filter & Search)
      description: >
        Lấy danh sách món ăn có phân trang.
        Hỗ trợ tìm kiếm theo tên, lọc theo danh mục, trạng thái, khoảng giá và món nổi bật.
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Trang số (Mặc định 1)
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Số lượng bản ghi mỗi trang (Mặc định 10, cho phép [10, 20, 30])
        - in: query
          name: search
          schema:
            type: string
          description: Từ khóa tìm kiếm (Tên món ăn)
        - in: query
          name: categoryId
          schema:
            type: string
          description: Lọc theo ID danh mục (ObjectId)
        - in: query
          name: status
          schema:
            type: string
            enum: [available, unavailable, hidden]
          description: Lọc theo trạng thái món
        - in: query
          name: isFeatured
          schema:
            type: boolean
          description: Lọc món nổi bật (true/false)
        - in: query
          name: minPrice
          schema:
            type: number
          description: Lọc giá tối thiểu
        - in: query
          name: maxPrice
          schema:
            type: number
          description: Lọc giá tối đa
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get list dishes successfully"
                  data:
                    type: object
                    properties:
                      dishes:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                            name:
                              type: string
                            price:
                              type: number
                            description:
                              type: string
                            image:
                              type: string
                            status:
                              type: string
                            isFeatured:
                              type: boolean
                            categoryName:
                              type: string
                              description: Tên danh mục (Lookup)
                            recipe:
                              type: array
                              items:
                                type: object
                                properties:
                                  ingredientId:
                                    type: string
                                  quantity:
                                    type: number
                                  ingredientName:
                                    type: string
                                    description: Tên nguyên liệu (Lookup)
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                          limit:
                            type: integer
                          total:
                            type: integer
                          totalPages:
                            type: integer
              example:
                message: "Get list dishes successfully"
                data:
                  dishes:
                    - _id: "692cf98aa018b5563c300239"
                      name: "Cánh gà chiên mắm (8 chiếc)"
                      price: 85000
                      description: "Cánh gà chiên nước mắm đậm đà, da giòn."
                      image: "https://res.cloudinary.com/dpmbhsbcg/image/upload/v1764555144/restaurant-app/img_1764555142678.jpg"
                      status: "available"
                      recipe:
                        - ingredientId: "692cf42ee2c4e6ad4964e8a5"
                          quantity: 0.8
                          ingredientName: "Cánh gà"
                      isFeatured: false
                      categoryName: "Danh mục đồ ăn nhanh"
                    - _id: "692cf925c75387d0237246bf"
                      name: "Cánh gà chiên mắm (6 chiếc)"
                      price: 85000
                      description: "Cánh gà chiên nước mắm đậm đà, da giòn."
                      image: "https://res.cloudinary.com/dpmbhsbcg/image/upload/v1764555044/restaurant-app/img_1764555042237.jpg"
                      status: "available"
                      recipe:
                        - ingredientId: "692cf42ee2c4e6ad4964e8a5"
                          quantity: 0.6
                          ingredientName: "Cánh gà"
                      isFeatured: false
                      categoryName: "Danh mục đồ ăn nhanh"
                  pagination:
                    page: 1
                    limit: 10
                    total: 3
                    totalPages: 1
        '401':
          description: Unauthorized
  /dishes/{id}:
    patch:
      tags:
        - Dishes
      summary: Cập nhật món ăn
      operationId: updateDish
      description: >
        Cập nhật thông tin món ăn.
        Chỉ gửi những trường cần thay đổi.
        Nếu gửi ảnh mới, ảnh cũ sẽ bị xóa và thay thế.
        Nếu không gửi ảnh, ảnh cũ được giữ nguyên.
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
          description: ID của món ăn cần sửa
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: File ảnh mới (Nếu không gửi -> Giữ ảnh cũ)
                name:
                  type: string
                  description: Tên món ăn mới
                  example: "Cánh gà chiên mắm (Sốt cay)"
                price:
                  type: number
                  description: Giá bán mới
                  example: 90000
                description:
                  type: string
                  description: Mô tả mới
                status:
                  type: string
                  enum: [available, unavailable, hidden]
                  description: Trạng thái kinh doanh
                categoryId:
                  type: string
                  description: ID danh mục mới (Phải tồn tại và Active)
                isFeatured:
                  type: boolean
                  description: Đánh dấu nổi bật
                recipe:
                  type: string
                  description: >
                    Chuỗi JSON công thức mới (sẽ ghi đè công thức cũ).
                    Format: `[{"ingredientId": "...", "quantity": ...}]`
                  example: '[{"ingredientId": "692cf2c3e2c4e6ad4964e8a3", "quantity": 0.5}]'
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Updated dish successfully"
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                      name:
                        type: string
                      price:
                        type: number
                      description:
                        type: string
                      image:
                        type: string
                      image_id:
                        type: string
                        description: Public ID của ảnh trên Cloudinary
                      status:
                        type: string
                      categoryId:
                        type: string
                      categoryName:
                        type: string
                        description: Tên danh mục (Lookup)
                      isFeatured:
                        type: boolean
                      recipe:
                        type: array
                        items:
                          type: object
                          properties:
                            ingredientId:
                              type: string
                            quantity:
                              type: number
                            ingredientName:
                              type: string
                              description: Tên nguyên liệu (Lookup)
              example:
                message: "Updated dish successfully"
                data:
                  _id: "692cf98aa018b5563c300239"
                  name: "Cánh gà chiên mắm (8 chiếc)"
                  price: 85000
                  description: "Cánh gà chiên nước mắm đậm đà, da giònn."
                  image: "https://res.cloudinary.com/dpmbhsbcg/image/upload/v1764561789/restaurant-app/img_1764561787028.jpg"
                  image_id: "restaurant-app/img_1764561787028"
                  status: "available"
                  categoryId: "692ceff06e1be3877b5ec4b3"
                  categoryName: "Danh mục đồ ăn nhanh"
                  isFeatured: false
                  recipe:
                    - ingredientId: "692cf42ee2c4e6ad4964e8a5"
                      quantity: 0.8
                      ingredientName: "Cánh gà"
        '400':
          description: Lỗi Validation hoặc Logic
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              examples:
                InvalidId:
                  summary: ID không hợp lệ
                  value:
                    message: "Invalid Dish ID"
                CategoryError:
                  summary: Danh mục lỗi
                  value:
                    message: "Dish category not found or inactive"
                IngredientError:
                  summary: Nguyên liệu lỗi
                  value:
                    message: "One or more ingredients in recipe are invalid"
                ImgError:
                  summary: Ảnh lỗi
                  value:
                    message: "File type not supported"
        '404':
          description: Không tìm thấy
          content:
            application/json:
              example:
                message: "Dish not found"
        '401':
          description: Unauthorized

  # Xong
  /dish-categories:
    post:
      tags:
        - Dish Category
      summary: Create Dish Category
      description: Tạo mới danh mục món ăn (Yêu cầu upload ảnh).
      operationId: createDishCategory
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: File ảnh danh mục (jpg, jpeg, png, webp)
                name:
                  type: string
                  minLength: 1
                  maxLength: 50
                  example: "Burger"
                description:
                  type: string
                  maxLength: 255
                  example: "Danh mục Burger"
                display_order:
                  type: integer
                  minimum: 1
                  example: 1
                status:
                  type: string
                  enum: [active, inactive, hidden]
                  example: "active"
              required:
                - image
                - name
                - display_order
                - status
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Dish category created successfully"
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "692faffcdab9b8cb472875da"
                      name:
                        type: string
                        example: "Burger"
                      display_order:
                        type: integer
                        example: 1
                      status:
                        type: string
                        example: "active"
                      image:
                        type: string
                        example: "https://res.cloudinary.com/..."
                      description:
                        type: string
                        example: "Danh mục Burger"
        '400':
          description: Bad Request (Lỗi liên quan đến File hoặc Logic)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  status:
                    type: integer
              examples:
                MissingFile:
                  summary: Thiếu file ảnh
                  value:
                    message: "Image is required"
                    status: 400
                InvalidFileType:
                  summary: Định dạng file không hỗ trợ
                  value:
                    message: "File type is not supported"
                    status: 400
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
        '422':
          description: Unprocessable Entity (Validation Error)
          content:
            application/json:
              schema:
                type: object
              examples:
                ValidationError:
                  summary: Lỗi dữ liệu đầu vào
                  value:
                    message: "Validation error"
                    errors:
                      name: "Category name length must be between 1 and 50"
                      display_order: "Display order must be a positive integer"
                      status: "Status is invalid"
    get:
      tags:
        - Dish Category
      summary: Get List Dish Categories
      description: Lấy danh sách danh mục món ăn có hỗ trợ phân trang, tìm kiếm và lọc theo trạng thái.
      operationId: getDishCategories
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Trang hiện tại
        - name: limit
          in: query
          schema:
            type: integer
            enum: [5, 10, 15]
            default: 5
          description: Số lượng bản ghi trên một trang (Chỉ cho phép 5, 10, 15)
        - name: search
          in: query
          schema:
            type: string
          description: Tìm kiếm theo tên hoặc mô tả
          example: "Burger"
        - name: status
          in: query
          schema:
            type: string
            enum: [active, inactive]
          description: Lọc theo trạng thái hoạt động
          example: "active"
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get dish categories success"
                  result:
                    type: object
                    properties:
                      dishCategories:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              example: "692faffcdab9b8cb472875da"
                            name:
                              type: string
                              example: "Burger"
                            display_order:
                              type: integer
                              example: 1
                            status:
                              type: string
                              example: "active"
                            image:
                              type: string
                              example: "https://res.cloudinary.com/..."
                            description:
                              type: string
                              example: "Danh mục Burger"
                      pagination:
                        type: object
                        properties:
                          currentPage:
                            type: integer
                            example: 1
                          limit:
                            type: integer
                            example: 5
                          total:
                            type: integer
                            example: 10
                          totalPages:
                            type: integer
                            example: 2
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
  /dish-categories/{id}:
    patch:
      tags:
        - Dish Category
      summary: Update Dish Category
      description: Cập nhật thông tin danh mục (Ảnh và các trường khác đều là tùy chọn).
      operationId: updateDishCategory
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: ID của danh mục cần cập nhật
          example: "692faffcdab9b8cb472875da"
      requestBody:
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: File ảnh mới (nếu muốn thay đổi)
                name:
                  type: string
                  minLength: 1
                  maxLength: 50
                  example: "Burger Special"
                description:
                  type: string
                  maxLength: 255
                  example: "Danh mục Burger đặc biệt"
                display_order:
                  type: integer
                  minimum: 1
                  example: 2
                status:
                  type: string
                  enum: [active, inactive]
                  example: "inactive"
              # Không có required vì tất cả đều optional khi update
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Dish category updated successfully"
                  data:
                    type: object
                    properties:
                      _id:
                        type: string
                        example: "692faffcdab9b8cb472875da"
                      name:
                        type: string
                        example: "Burger Special"
                      display_order:
                        type: integer
                        example: 2
                      status:
                        type: string
                        example: "inactive"
                      image:
                        type: string
                        example: "https://res.cloudinary.com/new-image-url..."
                      description:
                        type: string
                        example: "Danh mục Burger đặc biệt"
        '400':
          description: Bad Request (ID sai hoặc File không hợp lệ)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid MongoDB Id format"
              examples:
                InvalidID:
                  summary: ID không đúng định dạng
                  value:
                    message: "Category ID is invalid"
                InvalidFile:
                  summary: File ảnh không hỗ trợ
                  value:
                    message: "File type is not supported"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "accesstoken is require"
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Dish category not found"
        '422':
          description: Unprocessable Entity (Lỗi validation dữ liệu gửi lên)
          content:
            application/json:
              schema:
                type: object
              examples:
                InvalidData:
                  summary: Dữ liệu không hợp lệ
                  value:
                    message: "Validation error"
                    errors:
                      name: "Category name length must be between 1 and 50"
                      status: "Status is invalid"

  # order bên admin
  /orders:
    get:
      tags:
        - Orders
      summary: Lấy danh sách đơn hàng
      description: >
        Lấy danh sách đơn hàng cho trang Admin/Bếp.
        Hỗ trợ phân trang, tìm kiếm theo số bàn, lọc theo trạng thái món ăn và khoảng thời gian.
      operationId: adminGetAllOrders
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
          description: Trang hiện tại
        - name: limit
          in: query
          schema:
            type: integer
            default: 15
            enum: [15, 20, 25]
          description: Số lượng bản ghi mỗi trang
        - name: status
          in: query
          schema:
            type: string
            enum: [Pending, Cooking, Served, Reject]
          description: >
            Lọc theo trạng thái của **món ăn** (Item Status). 
            Nếu truyền giá trị này, danh sách `items` trong đơn hàng trả về sẽ chỉ chứa các món có trạng thái tương ứng.
        - name: search
          in: query
          schema:
            type: string
          description: Tìm kiếm theo số bàn (Table Number)
          example: "1"
        - name: dateFrom
          in: query
          schema:
            type: string
            format: date-time
          description: Lọc từ ngày (ISO string)
          example: "2025-12-08T00:00:00.000Z"
        - name: dateTo
          in: query
          schema:
            type: string
            format: date-time
          description: Lọc đến ngày (ISO string)
          example: "2025-12-09T23:59:59.999Z"
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get all orders successfully"
                  data:
                    type: object
                    properties:
                      orders:
                        type: array
                        items:
                          $ref: '#/components/schemas/OrderAdminResponse'
                      total:
                        type: integer
                        example: 50
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 15
                      totalPages:
                        type: integer
                        example: 4
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (Không có quyền view_orders)
  /orders/{order_id}/{item_id}:
    patch:
      tags:
        - Orders
      summary: Cập nhật trạng thái món ăn
      description: >
        Admin/Bếp cập nhật trạng thái của một món ăn cụ thể trong đơn hàng (Ví dụ: Từ Pending -> Cooking).
        Hành động này sẽ bắn socket `update_order_item` để thông báo cho các bên liên quan.
      operationId: adminUpdateOrderItemStatus
      security:
        - BearerAuth: []
      parameters:
        - name: order_id
          in: path
          required: true
          schema:
            type: string
          description: ID của đơn hàng (Order ID)
          example: "6936d080d41680e6b1977317"
        - name: item_id
          in: path
          required: true
          schema:
            type: string
          description: ID của món ăn trong đơn (Item ID)
          example: "6936d080d41680e6b1977319"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrderItemStatusReqBody'
      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Update item status successfully"
                  data:
                    $ref: '#/components/schemas/OrderAdminResponse'
        '400':
          description: Trạng thái không hợp lệ hoặc item không tìm thấy
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid status"
        '401':
          description: Unauthorized
  /orders/history:
      get:
        tags:
          - Orders
        summary: Lấy lịch sử đơn hàng (Đã thanh toán)
        description: |
          API lấy danh sách các đơn hàng có trạng thái `PAID`.
          - Hỗ trợ phân trang, lọc theo ngày.
          - **Search:** Tìm kiếm chính xác theo **Số bàn** (tableNumber).
          - **Dữ liệu Items:** Đã được làm sạch (bỏ món Reject), gom nhóm các món giống nhau và tính `subTotal`.
        security:
          - bearerAuth: []
        parameters:
          - in: query
            name: page
            schema:
              type: integer
              default: 1
            description: Trang hiện tại
          - in: query
            name: limit
            schema:
              type: integer
              default: 10
            description: Số lượng item trên mỗi trang
          - in: query
            name: search
            schema:
              type: string
            description: Tìm kiếm theo **Số bàn** (Ví dụ nhập "5" để tìm bàn 5)
          - in: query
            name: dateFrom
            schema:
              type: string
              format: date-time
            description: Lọc từ ngày (ISO String)
          - in: query
            name: dateTo
            schema:
              type: string
              format: date-time
            description: Lọc đến ngày (ISO String)
        responses:
          '200':
            description: Lấy lịch sử thành công
            content:
              application/json:
                schema:
                  $ref: '#/components/schemas/HistoryOrderResponse'
          '401':
            description: Unauthorized
          '500':
            description: Server Error
  /orders/history/{order_id}:
    get:
      tags:
        - Orders
      summary: Lấy danh sách món ăn của đơn hàng (Chi tiết)
      description: |
        API chỉ trả về danh sách **items** của một đơn hàng đã thanh toán.
        - Các thông tin chung (bàn, tổng tiền, khách...) đã có ở API danh sách nên không trả về ở đây.
        - Item trả về bao gồm cả món **Served** (đã ăn) và **Reject** (đã hủy) để xem lại lịch sử gọi món.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: order_id
          required: true
          schema:
            type: string
          description: ID của đơn hàng
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get order history detail successfully"
                  data:
                    $ref: '#/components/schemas/HistoryOrderDetailResponse'
        '400':
          description: Không tìm thấy đơn hoặc Order ID không hợp lệ
          
  # order bên khách, lưu ý không dùng path của admin
  /guest/auth/login:
    post:
      tags:
        - Guest Auth
      summary: Guest Login
      description: Đăng nhập cho khách hàng quét mã QR tại bàn.
      operationId: guestLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                guestName:
                  type: string
                  minLength: 1
                  maxLength: 50
                  description: Tên khách hàng (để hiển thị và phân biệt)
                  example: "John Doe"
                qrToken:
                  type: string
                  description: Token lấy từ mã QR trên bàn
                  example: "be772197701d5c2053b6aa7850a9d7438f0f98b6"
              required:
                - guestName
                - qrToken
      responses:
        '200':
          description: OK (Đăng nhập thành công)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Login successfully"
                  result:
                    type: object
                    properties:
                      accessToken:
                        type: string
                        description: Token dùng để xác thực các request tiếp theo (Đặt đơn, gọi nhân viên...)
                        example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                      guest:
                        type: object
                        properties:
                          id:
                            type: string
                            description: ID của bàn (Table ID)
                            example: "654a3b2c1d0e9f8a7b6c5d4e"
                          guestName:
                            type: string
                            example: "John Doe"
                          tableNumber:
                            type: integer
                            example: 5
                          status:
                            type: string
                            description: Trạng thái hiện tại của bàn
                            enum: [Available, Occupied, Reserved]
                            example: "Occupied"
                      currentOrderId:
                        type: string
                        nullable: true
                        description: ID đơn hàng hiện tại nếu bàn đang có khách (dùng để load lại bill cũ)
                        example: "6925d6a45b616421690a7150"
        '404':
          description: Not Found (QR Token không hợp lệ)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Table not found or invalid QR token"
        '422':
          description: Unprocessable Entity (Lỗi Validation)
          content:
            application/json:
              schema:
                type: object
              examples:
                MissingName:
                  summary: Thiếu tên khách
                  value:
                    message: "Validation error"
                    errors:
                      guestName: "Name is required"
                InvalidNameLength:
                  summary: Tên quá dài/ngắn
                  value:
                    message: "Validation error"
                    errors:
                      guestName: "Name length must be between 1 and 50 chars"
                MissingToken:
                  summary: Thiếu QR Token
                  value:
                    message: "Validation error"
                    errors:
                      qrToken: "QR Token is required"
  /guest/menu/{categoryId}/dishes:
    get:
      summary: Lấy danh sách món ăn theo danh mục (Guest)
      description: API lấy danh sách món ăn hiển thị cho khách, có phân trang (Page-based).
      tags:
        - Guest
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: categoryId
          schema:
            type: string
            example: "692fb10fdab9b8cb472075db"
          required: true
          description: ID của danh mục món ăn (ObjectId)
        - in: query
          name: page
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Số trang hiện tại
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
            enum: [10, 20, 30]
          description: Số lượng món trên một trang
      responses:
        '200':
          description: Lấy dữ liệu thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get menu successfully"
                  data:
                    type: object
                    properties:
                      menu:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              example: "692fded120cb0fc05c9c3376"
                            name:
                              type: string
                              example: "Cánh gà BBQ (6 miếng)"
                            price:
                              type: number
                              example: 129000
                            description:
                              type: string
                              example: "Cánh gà BBQ (6 miếng) kèm sốt đặc biệt"
                            image:
                              type: string
                              example: "https://res.cloudinary.com/.../img.jpg"
                            image_id:
                              type: string
                              example: "restaurant-app/img_12345"
                            status:
                              type: string
                              enum: [available, unavailable]
                              example: "available"
                            categoryId:
                              type: string
                              example: "692fb10fdab9b8cb472075db"
                            recipe:
                              type: array
                              items:
                                type: object
                                properties:
                                  ingredientId:
                                    type: string
                                    example: "692cf42ee2c4e6ad4964e8a5"
                                  quantity:
                                    type: number
                                    example: 0.6
                            isFeatured:
                              type: boolean
                              example: false
                            ratingAverage:
                              type: number
                              example: 4.5
                            reviewCount:
                              type: number
                              example: 12
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                            example: 1
                          limit:
                            type: integer
                            example: 20
                          total:
                            type: integer
                            example: 2
                          totalPages:
                            type: integer
                            example: 1
        '400':
          description: Lỗi validation (Ví dụ categoryId không hợp lệ)
        '401':
          description: Không có quyền truy cập (Thiếu hoặc sai Access Token)
        '422':
          description: Lỗi xử lý dữ liệu (Unprocessable Entity)
  /guest/dish-categories:
    get:
      summary: Lấy danh sách danh mục món ăn (Guest)
      description: API lấy danh sách tất cả các category để hiển thị menu (Burger, Chicken, Drink...).
      tags:
        - Guest
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get dish categories success"
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          description: ID của danh mục
                          example: "692faffcdab9b8cb472075da"
                        name:
                          type: string
                          description: Tên danh mục
                          example: "Burger"
                        display_order:
                          type: integer
                          description: Thứ tự hiển thị
                          example: 1
                        status:
                          type: string
                          description: Trạng thái hoạt động
                          enum: [active, inactive]
                          example: "active"
                        image:
                          type: string
                          format: uri
                          description: Link ảnh đại diện danh mục
                          example: "https://res.cloudinary.com/dpmbhsbcg/image/upload/v1764732923/restaurant-app/img_1764732922471.jpg"
                        description:
                          type: string
                          description: Mô tả ngắn gọn
                          example: "Danh mục Burger"
        '401':
          description: Không có quyền truy cập (Thiếu hoặc sai Access Token)
  /guest/orders:
    post:
      tags:
        - Guest
      summary: Guest Place Order (Đặt món)
      description: |
        Khách hàng gửi danh sách món ăn muốn đặt. 
        - Yêu cầu Token Guest (lấy từ API Login).
        - Hệ thống sẽ kiểm tra tồn kho, trạng thái món ăn.
        - Nếu thành công: Trừ kho, Lưu đơn hàng, Bắn Socket thông báo.
      operationId: guestCreateOrder
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderReqBody'
      responses:
        '200':
          description: Đặt món thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Order placed successfully"
                  data:
                    $ref: '#/components/schemas/OrderResponse'
        '400':
          description: Lỗi Business Logic (Hết hàng, Món không tồn tại, v.v.)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  status:
                    type: integer
                    example: 400
              examples:
                OutOfStock:
                  summary: Hết hàng
                  value:
                    message: "Dish 'Cánh gà chiên' is out of stock or not enough quantity"
                    status: 400
                DishHidden:
                  summary: Món đã bị ẩn/ngưng bán
                  value:
                    message: "Dish 'Coca cola' is currently unavailable"
                    status: 400
        '401':
          description: Lỗi xác thực (Thiếu token hoặc Token sai)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: 
                    type: string
                    example: "Access token is required" # Message từ USER_MESSAGES.ACCESS_TOKEN_IS_REQUIRED
        '403':
          description: Lỗi phân quyền (Token đúng nhưng không phải Guest)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message: 
                    type: string
                    example: "You are not authorized (Guest role required)"
        '422':
          description: Lỗi Validation (Dữ liệu đầu vào không hợp lệ)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Validation error"
                  errors:
                    type: object
              examples:
                InvalidFormat:
                  summary: Mảng items rỗng hoặc sai định dạng
                  value:
                    message: "Validation error"
                    errors:
                      items: "Order items must be an array"
                InvalidQuantity:
                  summary: Số lượng không hợp lệ
                  value:
                    message: "Validation error"
                    errors:
                      "items[0].quantity": "Quantity must be a positive integer"
                InvalidDishID:
                  summary: DishID không phải MongoID
                  value:
                    message: "Validation error"
                    errors:
                      "items[0].dishId": "Invalid Dish ID format"
  /payment/qr/{orderId}:
    get:
      tags:
        - Payment
      summary: Lấy mã QR thanh toán
      description: |
        Tạo và trả về đường dẫn ảnh QR Code để khách hàng chuyển khoản.
        
        **Quy tắc nghiệp vụ:**
        1. Đơn hàng phải tồn tại.
        2. **Quan trọng:** Tất cả các món ăn trong đơn phải hoàn thành (Status không được là `Pending` hoặc `Cooking`) thì mới được phép thanh toán.
      operationId: getPaymentQr
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: orderId
          schema:
            type: string
          required: true
          description: ID của đơn hàng (MongoDB ObjectId)
          example: "693f7a63e7455fa6893e7080"
      responses:
        '200':
          description: Lấy QR thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get payment QR successfully"
                  result:
                    type: string
                    description: Đường dẫn ảnh QR code
                    example: "https://qr.sepay.vn/img?acc=0327593620&bank=MB&amount=266000&des=DH693f7a63e7455fa6893e7080"
        '400':
          description: Lỗi Logic hoặc Validation
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  status:
                    type: integer
                    example: 400
              examples:
                UnfinishedOrder:
                  summary: Đơn hàng chưa phục vụ xong (Business Logic)
                  value:
                    message: "Tồn tại đơn hàng chưa phục vụ. Chưa thể thanh toán"
                    status: 400
                InvalidId:
                  summary: ID không đúng định dạng (Validation)
                  value:
                    message: "Invalid Order ID"
                    status: 400
        '401':
          description: Unauthorized (Chưa đăng nhập hoặc Token hết hạn)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Access token is required"
        '404':
          description: Không tìm thấy đơn hàng
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Order not found"
                  status:
                    type: integer
                    example: 404
  /payment/sepay-webhook:
    post:
      tags:
        - Payment
      summary: Webhook nhận thông báo thanh toán (Simulate SePay)
      description: |
        API này dùng để nhận dữ liệu từ SePay khi có giao dịch ngân hàng mới.
        **Dùng cho Testing:** Bạn có thể gọi API này thủ công để giả lập việc khách hàng đã chuyển khoản thành công, giúp server cập nhật trạng thái đơn hàng và bắn socket.
      operationId: paymentWebhook
      # Webhook thường là Public, không cần BearerAuth, nhưng tùy vào config server của bạn
      security: [] 
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
                - transferAmount
              properties:
                gateway:
                  type: string
                  example: "MBBank"
                transactionDate:
                  type: string
                  example: "2025-12-10 10:00:00"
                accountNumber:
                  type: string
                  example: "0327593620"
                content:
                  type: string
                  description: "Nội dung chuyển khoản. Bắt buộc phải có cú pháp: DH {OrderID}"
                  example: "DH 6943cf1d0d93d0d4529c1f3e"
                transferAmount:
                  type: number
                  description: "Số tiền chuyển khoản (Phải >= tổng tiền đơn hàng)"
                  example: 283000
                transferType:
                  type: string
                  example: "in"
      responses:
        '200':
          description: Xử lý thanh toán thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Payment processed successfully"
        '400':
          description: Lỗi xử lý (Sai cú pháp content, thiếu tiền, hoặc không tìm thấy đơn)
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Invalid content format (Order ID not found)"
  
  # --- GUEST REVIEWS ---
  /guest/reviews:
    post:
      tags:
        - Guest
      summary: Gửi đánh giá đơn hàng
      description: |
        Khách hàng gửi đánh giá cho các món ăn trong đơn hàng sau khi thanh toán.
        
        **Quy tắc:**
        1. Đơn hàng phải có trạng thái **PAID**.
        2. Khách chỉ được đánh giá đơn của chính bàn mình.
        3. Mỗi đơn hàng chỉ được đánh giá **1 lần duy nhất**.
        4. Gửi `rating: 0` nếu muốn bỏ qua không đánh giá món đó.
      operationId: createGuestReview
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateReviewReqBody'
      responses:
        '200':
          description: Đánh giá thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Gửi đánh giá thành công. Cảm ơn quý khách đã ủng hộ !"
        '400':
          description: Lỗi Logic (Đã đánh giá rồi, chưa thanh toán, hoặc Validation sai)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                  status:
                    type: integer
                    example: 400
              examples:
                AlreadyReviewed:
                  summary: Đơn hàng đã được đánh giá
                  value:
                    message: "Đơn hàng này đã được đánh giá rồi. Cảm ơn bạn!"
                    status: 400
                OrderNotPaid:
                  summary: Đơn hàng chưa thanh toán
                  value:
                    message: "Đơn hàng không tồn tại hoặc chưa thanh toán"
                    status: 400
                ValidationError:
                  summary: Lỗi dữ liệu đầu vào
                  value:
                    message: "Validation error"
                    errors:
                      "reviews[0].rating": "Rating must be from 0 to 5"
        '401':
          description: Chưa đăng nhập (Thiếu Token)
        '403':
          description: Không có quyền (Đánh giá đơn của bàn khác)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Bạn không có quyền đánh giá đơn hàng này"
                  status:
                    type: integer
                    example: 403
        '404':
          description: Không tìm thấy đơn hàng
  /guest/reviews/{dishId}:
    get:
      tags:
        - Guest
      summary: Lấy danh sách đánh giá theo món ăn
      description: |
        Xem danh sách các review của một món ăn cụ thể.
        Hỗ trợ phân trang (Pagination).
      operationId: getReviewsByDish
      security: [] # Thường là public, nếu cần auth thì thêm vào
      parameters:
        - in: path
          name: dishId
          schema:
            type: string
          required: true
          description: ID của món ăn cần xem review (MongoDB ObjectId)
          example: "694586247c1fa2c85610bcd2"
        - in: query
          name: page
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Trang hiện tại
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
            enum: [10, 20, 30]
          description: Số lượng review trên mỗi trang
      responses:
        '200':
          description: Lấy danh sách thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get all reviews by dish success"
                  result:
                    type: array
                    description: Danh sách các bài đánh giá
                    items:
                      type: object
                      properties:
                        _id:
                          type: string
                          example: "695a12..."
                        authorName:
                          type: string
                          example: "Nguyễn Văn A"
                        rating:
                          type: integer
                          example: 5
                        comment:
                          type: string
                          example: "Món này rất ngon, nước dùng đậm đà"
                        reply:
                          type: object
                          nullable: true
                          description: Phản hồi của nhà hàng (nếu có)
                          properties:
                            content:
                              type: string
                              example: "Cảm ơn bạn đã ủng hộ!"
                            adminName:
                              type: string
                              example: "Van Thu"
                            createdAt:
                              type: string
                              format: date-time
                        createdAt:
                          type: string
                          format: date-time
                          example: "2025-12-20T10:00:00.000Z"
                        dishName:
                          type: string
                          description: Tên món ăn (Lookup từ bảng dishes)
                          example: "Phở Bò Tái"
                        dishImage:
                          type: string
                          description: URL ảnh món ăn (Lookup từ bảng dishes)
                          example: "https://example.com/pho-bo.jpg"
        '400':
          description: Lỗi ID không hợp lệ hoặc không tìm thấy review
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid Dish ID"
                  status:
                    type: integer
                    example: 400
  /guest/recommendations:
    post:
      tags:
        - Guest
      summary: Gợi ý món ăn thông minh (AI Powered)
      description: |
        API này sử dụng Google Gemini AI để phân tích các món đang có trong giỏ hàng (dishIds) và đề xuất 3 món ăn kèm phù hợp nhất từ Menu.
        - Nếu giỏ hàng rỗng hoặc không gửi `dishIds`: Trả về 3 món Nổi bật (Featured).
        - Nếu AI bị lỗi hoặc Timeout (2.5s): Fallback về 5 món Nổi bật.
        - Có sử dụng Caching (Recommendation Collection) để tối ưu tốc độ cho các tổ hợp món lặp lại.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CartRecommendationRequest'
      responses:
        '200':
          description: Lấy danh sách gợi ý thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get cart recommendations success"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DishRecommendationItem'
        '400':
          description: Lỗi validation (dishIds không phải mảng hoặc ID sai định dạng)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Chưa đăng nhập (Thiếu/Sai Token)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
  # --- ADMIN REVIEWS ---
  /reviews:
    get:
      tags:
        - Admin Reviews
      summary: Lấy danh sách đánh giá (Admin)
      description: >
        Lấy tất cả đánh giá trong hệ thống. Hỗ trợ lọc theo món ăn, số sao, trạng thái.
        Kết quả trả về bao gồm cả thông tin món ăn (tên, ảnh) để Admin dễ theo dõi.
      operationId: getAllReviewsAdmin
      security:
        - BearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
        - name: dishId
          in: query
          schema:
            type: string
          description: Lọc theo món ăn
        - name: rating
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 5
          description: | 
            Lọc theo số sao (VD: Lọc các bài 1 sao để xử lý)
        - name: status
          in: query
          schema:
            type: string
            enum: [Active, Hidden]
          description: Lọc theo trạng thái
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Get admin reviews successfully"
                  data:
                    type: object
                    properties:
                      reviews:
                        type: array
                        items:
                          $ref: '#/components/schemas/ReviewAdminObject'
                      total:
                        type: integer
                      totalPages:
                        type: integer
  /admin/reviews/{reviewId}/reply:
    post:
      tags:
        - Admin Reviews
      summary: Admin trả lời đánh giá
      description: |
        Admin gửi nội dung phản hồi cho một review cụ thể.
        Hệ thống sẽ lưu nội dung, ID admin thực hiện và thời gian trả lời vào database.
      operationId: replyReview
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: reviewId
          schema:
            type: string
          required: true
          description: ID của bài đánh giá cần trả lời (MongoDB ObjectId)
          example: "6945677b4f023c8c85fe044e"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - content
              properties:
                content:
                  type: string
                  description: Nội dung câu trả lời của Admin
                  minLength: 1
                  example: "Cảm ơn bạn đã ghé thăm. Chúng tôi sẽ cố gắng cải thiện hơn nữa!"
      responses:
        '200':
          description: Trả lời thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Reply review success"
                  data:
                    $ref: '#/components/schemas/ReviewObject'
        '400':
          description: Lỗi Validation (Thiếu content hoặc ID sai định dạng)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Content reply is required"
                  status:
                    type: integer
                    example: 400
        '401':
          description: Unauthorized (Chưa đăng nhập)
        '404':
          description: Không tìm thấy bài đánh giá
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Review not found"
                  status:
                    type: integer
                    example: 404
  /admin/reviews/{reviewId}/{status}:
    patch:
      tags:
        - Admin Reviews
      summary: Thay đổi trạng thái đánh giá (Duyệt/Ẩn)
      description: |
        API dành cho Admin để cập nhật trạng thái hiển thị của một đánh giá.
        Thường dùng để chuyển từ `Hidden` (do Spam filter chặn) sang `Active` (nếu bắt nhầm), hoặc ngược lại.
      operationId: changeReviewStatus
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: reviewId
          schema:
            type: string
          required: true
          description: ID của đánh giá (MongoDB ObjectId)
          example: "6945677b4f023c8c85fe044e"
        - in: path
          name: status
          schema:
            type: string
            enum: [Active, Hidden]
          required: true
          description: Trạng thái mới cần cập nhật
          example: "Active"
      responses:
        '200':
          description: Cập nhật trạng thái thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Change review status success"
                  result:
                    type: object
                    description: Thông tin đánh giá sau khi cập nhật
                    properties:
                      _id:
                        type: string
                        example: "6945677b4f023c8c85fe044e"
                      dishId:
                        type: string
                        example: "694506247c1fa2c05610bcd2"
                      orderId:
                        type: string
                        example: "694528157c1fa2c05610bd1a"
                      authorName:
                        type: string
                        example: "Hieu Bui"
                      rating:
                        type: integer
                        example: 5
                      comment:
                        type: string
                        example: "Ngon"
                      status:
                        type: string
                        enum: [Active, Hidden]
                        example: "Active"
                      createdAt:
                        type: string
                        format: date-time
                        example: "2025-12-19T14:55:55.111Z"
        '400':
          description: Lỗi Validation (ID sai định dạng hoặc Status không nằm trong Enum)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Invalid Review Status"
                  status:
                    type: integer
                    example: 400
        '401':
          description: Unauthorized (Chưa đăng nhập)
        '403':
          description: Forbidden (Không có quyền Admin)
        '404':
          description: Không tìm thấy đánh giá (Review Not Found)

  # Setting
  /settings:
    # ===========================================
    # 1. GET: Lấy cấu hình
    # ===========================================
    get:
      tags:
        - Settings
      summary: Lấy thông tin cấu hình nhà hàng
      description: API Public, dùng cho cả trang Admin và Landing Page.
      responses:
        '200':
          description: Thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy cấu hình thành công"
                  data:
                    $ref: '#/components/schemas/RestaurantSettings'

    # ===========================================
    # 2. PUT: Cập nhật cấu hình
    # ===========================================
    patch:
      tags:
        - Settings
      summary: Tạo mới hoặc Cập nhật cấu hình (Admin)
      description: >
        API cập nhật toàn bộ thông tin nhà hàng.
        
        **Lưu ý quan trọng (Multipart/Form-data):**
        1. Các trường Object/Array (`gallerySection`, `aboutUsSection`...) phải được **JSON.stringify()** trước khi gửi.
        2. Thứ tự file trong `galleryImages` sẽ khớp với thứ tự object trong mảng `gallerySection.images` JSON.
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                # --- A. CÁC FILE UPLOAD ---
                logo:
                  type: string
                  format: binary
                  description: Upload Logo (1 file)
                favicon:
                  type: string
                  format: binary
                  description: Upload Favicon (1 file)
                
                aboutUsImage:
                  type: string
                  format: binary
                  description: Upload ảnh cho phần Về chúng tôi (1 file)
                
                heroImages:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Upload danh sách Banner (Nhiều file)
                
                galleryImages:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Upload danh sách ảnh Gallery (Nhiều file). Thứ tự file khớp với thứ tự mô tả trong JSON.

                # --- B. THÔNG TIN CƠ BẢN (TEXT) ---
                brandName:
                  type: string
                  example: "SNACKIO Premium"
                slogan:
                  type: string
                  example: "Tinh hoa ẩm thực Việt"
                description:
                  type: string
                address:
                  type: string
                hotline:
                  type: string
                email:
                  type: string

                # --- C. CÁC JSON STRING (Cần Stringify từ Frontend) ---
                
                heroSection:
                  type: string
                  description: 'JSON String. VD: `{"isActive": true}`'
                  example: '{"isActive": true}'

                aboutUsSection:
                  type: string
                  description: >
                    JSON String cấu hình About Us + Detail.
                    VD: `{"isActive": true, "title": "...", "detail": {"years": 10, "branches": 5}}`
                  example: '{"isActive": true, "title": "Về chúng tôi", "detail": {"years": 10, "total_orders": 999}}'

                gallerySection:
                  type: string
                  description: >
                    JSON String cấu hình Gallery + Mô tả ảnh.
                    **Quan trọng:** Mảng `images` chứa description phải khớp số lượng với file upload `galleryImages`.
                  example: '{"isActive": true, "images": [{"description": "Sảnh chính"}, {"description": "Góc Chill"}]}'

                socialLinks:
                  type: string
                  description: 'JSON String mảng mạng xã hội.'
                  example: '[{"platform": "Facebook", "url": "..."}]'

                openingHours:
                  type: string
                  description: 'JSON String giờ mở cửa.'
                  example: '[{"label": "Thứ 2 - CN", "time": "8h - 22h"}]'

      responses:
        '200':
          description: Cập nhật thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Cập nhật cấu hình nhà hàng thành công!"
                  data:
                    $ref: '#/components/schemas/RestaurantSettings'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (Không phải Admin)
  
  /dashboard/stats:
    get:
      tags:
        - Dashboard
      summary: Lấy dữ liệu thống kê tổng quan (Admin)
      description: >
        API trả về dữ liệu toàn diện cho trang Dashboard:
        1. **Stats**: 4 thẻ chỉ số (Doanh thu, Đơn hàng, Món ăn, Bàn).
        2. **Chart**: Dữ liệu biểu đồ doanh thu theo khung giờ (ngày) hoặc ngày (tuần/tháng).
        3. **Top Products**: 5 món ăn bán chạy nhất (theo doanh thu).
        4. **Recent Orders**: 5 đơn hàng mới nhất kèm trạng thái xử lý thời gian thực.
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: type
          schema:
            type: string
            enum: [day, week, month]
            default: day
          description: >
            Khung thời gian thống kê:
            - `day`: Xem theo giờ trong ngày hôm nay (so với hôm qua).
            - `week`: Xem theo thứ trong tuần này (so với tuần trước).
            - `month`: Xem theo ngày trong tháng này (so với tháng trước).
      responses:
        '200':
          description: Lấy dữ liệu thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Success"
                  data:
                    type: object
                    properties:
                      # --- 1. THẺ THỐNG KÊ (4 Cards) ---
                      stats:
                        type: array
                        items:
                          type: object
                          properties:
                            key:
                              type: string
                              enum: [revenue, orders, dishes, tables]
                              description: Mã định danh của thẻ
                            label:
                              type: string
                              description: | 
                                Tên hiển thị (VD: Tổng doanh thu)
                            value:
                              oneOf:
                                - type: number
                                - type: string
                              description: Giá trị chính (Số tiền, số lượng hoặc string tỉ lệ bàn '12/20')
                              example: 15450000
                            trend_value:
                              type: number
                              description: | 
                                Phần trăm tăng/giảm (VD: 12.5)
                            trend_type:
                              type: string
                              enum: [up, down, neutral]
                              description: Hướng mũi tên (Tăng/Giảm/Đi ngang)
                            trend_label:
                              type: string
                              description: | 
                                Nhãn so sánh (VD: 'so với hôm qua')

                      # --- 2. BIỂU ĐỒ (Chart) ---
                      chart:
                        type: object
                        properties:
                          categories:
                            type: array
                            description: Nhãn trục hoành (Giờ hoặc Ngày/Thứ)
                            items:
                              type: string
                            example: ["08:00", "09:00", "10:00", "11:00"]
                          series:
                            type: array
                            items:
                              type: object
                              properties:
                                name:
                                  type: string
                                  example: "Doanh thu"
                                data:
                                  type: array
                                  description: Dữ liệu trục tung (Tiền)
                                  items:
                                    type: number
                                  example: [0, 500000, 1200000, 850000]

                      # --- 3. TOP MÓN BÁN CHẠY ---
                      top_products:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              description: ID món ăn
                            name:
                              type: string
                              example: "Lẩu Thái Hải Sản"
                            price:
                              type: number
                              description: Giá bán trung bình hoặc giá hiện tại
                              example: 350000
                            sales:
                              type: integer
                              description: Số lượng đã bán (quantity)
                              example: 45
                            revenue:
                              type: number
                              description: Tổng doanh thu từ món này
                              example: 15750000

                      # --- 4. ĐƠN HÀNG GẦN ĐÂY ---
                      recent_orders:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              description: ID đơn hàng
                            table:
                              type: string
                              description: Tên bàn
                              example: "Bàn 10"
                            amount:
                              type: number
                              description: Tổng tiền đơn hàng (totalAmount)
                              example: 540000
                            status:
                              type: string
                              enum: [completed, cooking, serving, pending]
                              description: >
                                Trạng thái hiển thị (Logic):
                                - `completed`: Đã thanh toán (PAID).
                                - `cooking`: Chưa trả tiền + Có món đang nấu.
                                - `serving`: Chưa trả tiền + Có món đã lên bàn.
                                - `pending`: Đơn mới tạo.
                              example: "cooking"
                            type:
                              type: string
                              example: "Dùng tại bàn"
                            time:
                              type: string
                              description: Giờ tạo đơn (Format HH:mm)
                              example: "19:30"

        '401':
          description: Chưa đăng nhập (Thiếu Token)
        '403':
          description: Không có quyền truy cập (Token không phải Admin)
        '500':
          description: Lỗi Server
  /dishes/public:
    get:
      tags:
        - Public API
      summary: Lấy danh sách món ăn (Public)
      description: >
        API lấy danh sách món ăn hiển thị ra trang chủ/thực đơn.
        Chỉ trả về các món có trạng thái `AVAILABLE` và chưa bị xóa.
      parameters:
        - in: query
          name: isFeatured
          schema:
            type: boolean
            example: true
          description: Nếu gửi `true`, chỉ lấy các món nổi bật (Best Seller).
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Giới hạn số lượng món hiển thị.
      responses:
        '200':
          description: Lấy dữ liệu thành công
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Lấy thực đơn thành công"
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        _id:  # 👈 Thêm trường này
                          type: string
                          example: "654321..."
                        name:
                          type: string
                          example: "Gà Rán Combo"
                        price:
                          type: number
                          example: 150000
                        image:
                          type: string
                          example: "https://res.cloudinary.com/demo/image/upload/dish1.jpg"
                        description:
                          type: string
                          example: "Gà rán giòn rụm kèm khoai tây chiên"
        '500':
          description: Lỗi Server
components:
  schemas:
    Table:
      type: object
      properties:
        _id:
          type: string
          description: ID duy nhất của bàn (MongoDB ObjectId)
          example: "6908bd8b93418ddd670d7098"
        number:
          type: integer
          description: Số thứ tự của bàn
          example: 1
        capacity:
          type: integer
          description: Sức chứa của bàn (số người)
          example: 10
        status:
          $ref: '#/components/schemas/TableStatus'
        currentOrderId:
          type: string
          nullable: true
          example: null
        QRcode:
          type: string
          description: Mã QR của bàn dưới dạng Data URL (base64)
          example: "data:image/png;base64,iVBORw0KGgo...[dữ liệu base64]..."
      # Các trường bắt buộc
      required:
        - _id
        - number
        - capacity
        - status
        - QRcode
    TableStatus:
      type: string
      description: Trạng thái của bàn ăn
      enum:
        - available
        - occupied
        - reserved
        - needs_cleaning
    UpdateTableRequest: 
      type: object
      description: Dữ liệu để cập nhật một bàn (chỉ chứa các trường có thể cập nhật)
      properties:
        capacity:
          type: integer
          description: Sức chứa mới của bàn
          example: 6
        status:
          $ref: '#/components/schemas/TableStatus'
    
    Supplier:
      type: object
      properties:
        _id:
          type: string
          description: ID duy nhất của nhà cung cấp (MongoDB ObjectId)
          example: "6912ac85d509c162b40b2e77"
        name:
          type: string
          description: Tên nhà cung cấp
          example: "Hong Hanh 2"
        taxCode:
          type: string
          description: Mã số thuế của nhà cung cấp
          example: "TX12345645"
        status:
          $ref: '#/components/schemas/SupplierStatus' # Giả định bạn có schema SupplierStatus
        contactPerson:
          type: string
          description: Tên người liên hệ
          example: "Hong Hanh"
        phone:
          type: string
          description: Số điện thoại liên hệ
          example: "+84901234567"
        email:
          type: string
          description: Địa chỉ email liên hệ
          example: "contact@honghanhtextile.com"
        address:
          type: string
          description: Địa chỉ của nhà cung cấp
          example: "123 Nguyen Trai Street, District 5, Ho Chi Minh City"
    CreateSupplierBody:
      type: object
      properties:
        name:
          type: string
          description: Tên nhà cung cấp
          example: "Hong Hanh 2"
        taxCode:
          type: string
          description: Mã số thuế
          example: "TX12345645"
        status:
          $ref: '#/components/schemas/SupplierStatus'
        contactPerson:
          type: string
          description: Tên người liên hệ
          example: "Hong Hanh"
        phone:
          type: string
          description: Số điện thoại liên hệ
          example: "+84901234567"
        email:
          type: string
          description: Địa chỉ email liên hệ
          example: "contact@honghanhtextile.com"
        address:
          type: string
          description: Địa chỉ của nhà cung cấp
          example: "123 Nguyen Trai Street, District 5, Ho Chi Minh City"
      required: # Dựa trên JSON, có vẻ tất cả đều bắt buộc
        - name
        - taxCode
        - status
        - contactPerson
        - phone
        - email
        - address
    UpdateSupplierBody:
      type: object
      properties:
        name:
          type: string
          description: Tên nhà cung cấp mới
          example: "Hong Hanh 2"
        taxCode:
          type: string
          description: Mã số thuế mới
          example: "TX12345645"
        status:
          $ref: '#/components/schemas/SupplierStatus'
        contactPerson:
          type: string
          description: Tên người liên hệ mới
          example: "Hong Hanh"
        phone:
          type: string
          description: Số điện thoại liên hệ mới
          example: "+84901234567"
        email:
          type: string
          description: Địa chỉ email liên hệ mới
          example: "contact@honghanhtextile.com"
        address:
          type: string
          description: Địa chỉ của nhà cung cấp mới
          example: "123 Nguyen Trai Street, District 5, Ho Chi Minh City"
    SupplierStatus:
      type: string
      description: Trạng thái của nhà cung cấp
      enum:
        - active
        - inactive
    
    Permission: 
      type: object
      properties:
        _id:
          type: string
          description: ID duy nhất của quyền (MongoDB ObjectId)
          example: "691a9e5c7800bd3806be2592"
        name:
          type: string
          description: Tên của quyền hạn (API endpoint hoặc action)
          example: create_table
        description:
          type: string
          description: Mô tả chi tiết về chức năng của quyền này
          example: Tạo mới một bàn
        module:
          type: string
          description: Tên module mà quyền này thuộc về 
          example: table
    createPermissionReqBody:
      type: object
      properties:
        name:
          type: string
          description: Tên quyền
          example: create_table
        description:
          type: string
          description: Mô tả quyền
          example: Tạo một bàn ăn mới
        module:
          type: string
          example: table
      required:
        - name
    UpdatePermissionReqBody:
      type: object
      properties:
        name:
          type: string
          example: create_table
        description:
          type: string
          example: Create a new table in the restaurant.
        module:
          type: string
          example: table
  
    CreateRoleReqBody:
      type: object
      required:
        - name
        - status
        - permissionIds
      properties:
        name:
          type: string
          example: Employee 1
        description:
          type: string
          example: ""
        status: 
          $ref: "#/components/schemas/RoleStatus"
        permissionIds:
          type: array
          items:
            type: string
          example: ["6915915c7d31b24b66fd0c13","6915917c7d31b24b66fd0c15"]
    Role:
      type: object
      properties:
        _id:
          type: string
          example: 691aa3757800bd3806be2595
        name:
          type: string
          example: Employee 1
        description:
          type: string
          example: ""
        status:
          $ref: "#/components/schemas/RoleStatus"
        permissionIds:
          type: array
          items:
            type: string
          example: ["6915915c7d31b24b66fd0c13","6915917c7d31b24b66fd0c15"]  
    RoleStatus:
      type: string
      description: Trạng thái của Role
      enum:
        - active
        - inactive
      example: active

    RoleWithPermissions:
      type: object
      properties:
        _id:
          type: string
          example: 6911a5cbd2c16ce645a813a0
        name:
          type: string
          example: Admin
        description:
          type: string
          example: Admin's permissions
        status:
          $ref: "#/components/schemas/RoleStatus"
        permissions:
          type: array
          items:
            $ref: "#/components/schemas/Permission"
    UpdateRoleReqBody:
      type: object
      properties:
        name:
          type: string
          example: Admin
        description:
          type: string
          example: Admin's permissions
        status:
          $ref: "#/components/schemas/RoleStatus"
        permissionIds:
          type: array
          items:
            type: string
          example: [
            "6915919f7d31b24b66fd0c17",
            "6915915c7d31b24b66fd0c13",
            "6915917c7d31b24b66fd0c15"
          ]
    
    ImportOrderStatus:
      type: string
      enum:
        - draft
        - confirmed
    ImportOrderItem:
      type: object
      properties:
        ingredientId:
          type: string
        ingredientName:
          type: string
        quantity:
          type: number
        importPrice:
          type: number
        total:
          type: number
    ImportOrder:
      type: object
      properties:
        _id:
          type: string
        orderNumber:
          type: string
        supplierId:
          type: string
        importedById:
          type: string
        importDate:
          type: string
          format: date-time
        status:
          $ref: "#/components/schemas/ImportOrderStatus"
        items:
          type: array
          items:
            $ref: "#/components/schemas/ImportOrderItem"
        subtotal:
          type: number
        taxRate:
          type: number
        taxAmount:
          type: number
        totalAmount:
          type: number
        notes:
          type: string
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    ImportOrderListItem:
      type: object
      properties:
        orderNumber:
          type: string
        importDate:
          type: string
          format: date-time
        status:
          type: string
        totalAmount:
          type: number
        supplierName:
          type: string
        importedByName:
          type: string
    ImportOrderDetail:
      allOf:
        - $ref: "#/components/schemas/ImportOrder"
        - type: object
          properties:
            supplierName:
              type: string
            importedByName:
              type: string
            items:
              type: array
              items:
                type: object
                properties:
                  ingredientId:
                    type: string
                  ingredientName:
                    type: string
                  unit:
                    type: string
                  quantity:
                    type: number
                  importPrice:
                    type: number
                  total:
                    type: number
    CreateImportOrderReqBody:
      type: object
      required:
        - supplierId
        - importDate
        - status
        - items
      properties:
        supplierId:
          type: string
        importDate:
          type: string
          format: date
        taxRate:
          type: number
          default: 0
        notes:
          type: string
        status:
          $ref: "#/components/schemas/ImportOrderStatus"
        items:
          type: array
          items:
            type: object
            required:
              - ingredientId
              - quantity
              - importPrice
            properties:
              ingredientId:
                type: string
              quantity:
                type: number
              importPrice:
                type: number

    # --- GUEST ORDER SCHEMAS ---
    CreateOrderReqBody:
      type: object
      required:
        - items
      properties:
        items:
          type: array
          description: Danh sách các món ăn muốn đặt (Bắt buộc phải có ít nhất 1 món)
          items:
            type: object
            required:
              - dishId
              - quantity
            properties:
              dishId:
                type: string
                description: ID của món ăn (Mongo ObjectId)
                example: "692fe855d1d14ce2ee11a96e"
              quantity:
                type: integer
                description: Số lượng (Phải là số nguyên > 0)
                minimum: 1
                example: 2
              note:
                type: string
                description: Ghi chú cho món ăn (Optional)
                example: "Không lấy tương ớt"
    OrderResponse:
      type: object
      properties:
        _id:
          type: string
          example: "6936d080d41680e6b1977317"
        tableId:
          type: string
          example: "692fab779ee9b37ecbf71d71"
        tableNumber:
          type: integer
          example: 1
        status:
          type: string
          enum: [Pending, Processing, Completed, Cancelled] # Thêm các enum thực tế của bạn
          example: "Pending"
        totalAmount:
          type: number
          description: Tổng tiền của đơn hàng
          example: 386000
        createdAt:
          type: string
          format: date-time
          example: "2025-12-08T13:20:00.279Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-12-09T04:30:30.939Z"
        finishedAt:
          type: string
          format: date-time
          nullable: true
          example: null
        items:
          type: array
          items:
            type: object
            properties:
              _id:
                type: string
                description: ID riêng của từng item trong đơn (dùng để update status)
                example: "6936d080d41680e6b1977318"
              dishId:
                type: string
                example: "692fe855d1d14ce2ee11a96e"
              dishName:
                type: string
                example: "Cánh gà BBQ (4 miếng)"
              dishPrice:
                type: number
                example: 89000
              dishImage:
                type: string
                example: "https://res.cloudinary.com/..."
              quantity:
                type: integer
                example: 2
              note:
                type: string
                example: "Không lấy tương ớt"
              orderedBy:
                type: string
                description: Tên người đặt món
                example: "Minh Nguyen"
              status:
                type: string
                description: Trạng thái của từng món (Pending, Cooking, Served, etc.)
                example: "Served"
              createdAt:
                type: string
                format: date-time
              updatedAt:
                type: string
                format: date-time

    # --- ADMIN ORDERS SCHEMAS ---
    OrderItemStatus:
      type: string
      enum: [Pending, Cooking, Served, Reject]
      description: Trạng thái của món ăn

    OrderItemDetail:
      type: object
      properties:
        _id:
          type: string
          description: ID riêng của item (Dùng để update)
          example: "6936d080d41680e6b1977319"
        dishId:
          type: string
          example: "692fea21d1d14ce2ee11a972"
        dishName:
          type: string
          example: "Khoai tây chiên (Cỡ vừa)"
        dishPrice:
          type: number
          example: 29000
        dishImage:
          type: string
          example: "https://res.cloudinary.com/..."
        quantity:
          type: integer
          example: 2
        note:
          type: string
          example: "Ít muối"
        orderedBy:
          type: string
          description: Tên người đặt món
          example: "Minh Nguyen"
        status:
          $ref: '#/components/schemas/OrderItemStatus'
        managedBy:
          type: string
          description: Tên nhân viên xử lý trạng thái gần nhất
          example: "Minh Admin"
        processingHistory:
          type: array
          description: Lịch sử xử lý món ăn
          items:
            type: object
            properties:
              status: 
                type: string
                example: "Cooking"
              updatedBy:
                type: string
                example: "Minh Admin"
              updatedAt:
                type: string
                format: date-time
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    OrderAdminResponse:
      type: object
      properties:
        _id:
          type: string
          example: "6936d080d41680e6b1977317"
        tableId:
          type: string
          example: "692fab779ee9b37ecbf71d71"
        tableNumber:
          type: integer
          example: 1
        status:
          type: string
          description: Trạng thái chung của đơn hàng
          example: "Pending"
        totalAmount:
          type: number
          description: Tổng tiền (Optional - có thể tính toán ở FE hoặc BE trả về)
          example: 386000
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
        items:
          type: array
          description: Danh sách món ăn trong đơn
          items:
            $ref: '#/components/schemas/OrderItemDetail'

    UpdateOrderItemStatusReqBody:
      type: object
      required:
        - status
      properties:
        status:
          $ref: '#/components/schemas/OrderItemStatus'
      example:
        status: "Cooking"

    
    # --- REVIEW SCHEMAS ---
    CreateReviewReqBody:
      type: object
      required:
        - orderId
        - reviews
      properties:
        orderId:
          type: string
          description: ID của đơn hàng (MongoDB ObjectId)
          example: "694586247c1fa2c85610bcd2"
        reviews:
          type: array
          description: Danh sách các món muốn đánh giá (Hoặc bỏ qua)
          minItems: 1
          items:
            type: object
            required:
              - dishId
              - rating
            properties:
              dishId:
                type: string
                description: ID của món ăn
                example: "694586247c1fa2c85610bcd2"
              rating:
                type: integer
                minimum: 0
                maximum: 5
                description: Điểm đánh giá (1-5). Gửi 0 nếu muốn bỏ qua món này.
                example: 5
              comment:
                type: string
                description: Nội dung đánh giá (Tùy chọn)
                maxLength: 500
                example: "Món này rất ngon!"
      example:
        orderId: "694586247c1fa2c85610bcd2"
        reviews:
          - dishId: "692fea21d1d14ce2ee11a972"
            rating: 5
            comment: "Tuyệt vời"
          - dishId: "692fea21d1d14ce2ee11a973"
            rating: 0
            comment: ""
    ReviewReply:
      type: object
      properties:
        content:
          type: string
          example: "Cảm ơn quý khách đã ủng hộ!"
        adminId:
          type: string
          description: ID của admin trả lời
        createdAt:
          type: string
          format: date-time
    ReviewObject:
      type: object
      description: Object review trả về cho Guest
      properties:
        _id:
          type: string
        authorName:
          type: string
          example: "Minh Nguyen"
        rating:
          type: integer
          example: 5
        comment:
          type: string
          example: "Tuyệt vời!"
        reply:
          $ref: '#/components/schemas/ReviewReply'
        createdAt:
          type: string
          format: date-time
    ReviewAdminObject:
      type: object
      description: Object review chi tiết trả về cho Admin (Kèm thông tin món)
      properties:
        _id:
          type: string
        dishId:
          type: string
        dishName:
          type: string
          description: Tên món ăn (được lookup từ bảng Dish)
          example: "Cánh gà chiên mắm"
        dishImage:
          type: string
          example: "https://res.cloudinary.com/..."
        authorName:
          type: string
        rating:
          type: integer
        comment:
          type: string
        status:
          type: string
          enum: [Active, Hidden]
          example: "Active"
        reply:
          $ref: '#/components/schemas/ReviewReply'
        createdAt:
          type: string
          format: date-time
    # Schema Input
    CartRecommendationRequest:
      type: object
      properties:
        dishIds:
          type: array
          description: Danh sách _id các món đang có trong giỏ hàng để AI phân tích.
          items:
            type: string
            description: MongoDB ObjectId
          example: 
            - "65f2ea21d1d14ce2ee11a972"
            - "65f2ea21d1d14ce2ee11a973"
    # Schema Output Item
    DishRecommendationItem:
      type: object
      properties:
        _id:
          type: string
          example: "65f2ea21d1d14ce2ee11a999"
        name:
          type: string
          example: "Pepsi không đường"
        price:
          type: number
          example: 15000
        image:
          type: string
          example: "https://res.cloudinary.com/.../pepsi.jpg"
        ratingAverage:
          type: number
          example: 4.5
        reviewCount:
          type: number
          example: 120
    
    HistoryOrderResponse:
      type: object
      properties:
        orders:
          type: array
          items:
            $ref: '#/components/schemas/HistoryOrderObject'
        meta:
          type: object
          properties:
            totalRevenue:
              type: number
              description: Tổng doanh thu của danh sách trả về (đã tính tổng totalAmount của các order)
              example: 5000000
            count:
              type: integer
              description: Tổng số lượng đơn hàng tìm thấy trong DB (dùng cho phân trang)
        pagination:
          type: object
          properties:
            page:
              type: integer
            limit:
              type: integer
            totalPages:
              type: integer
    HistoryOrderObject:
      type: object
      properties:
        _id:
          type: string
        tableNumber:
          type: integer
          description: Số bàn
        guestName:
          type: string
          description: Tên khách hàng (nếu có)
        totalAmount:
          type: number
          description: Tổng tiền của cả đơn
        paymentMethod:
          type: string
          enum: [CASH, BANK]
        createdAt:
          type: string
          format: date-time
        finishedAt:
          type: string
          format: date-time
        items:
          type: array
          description: Danh sách món ăn đã được gom nhóm và làm sạch
          items:
            $ref: '#/components/schemas/HistoryOrderItem'
    HistoryOrderItem:
      type: object
      properties:
        dishId:
          type: string
        dishName:
          type: string
        dishPrice:
          type: number
        quantity:
          type: integer
          description: Số lượng đã được cộng dồn từ các lần gọi
        subTotal:
          type: number
          description: Thành tiền (dishPrice * quantity)
        status:
          type: string
          enum: [Served, Cooking, Pending]
          description: Trạng thái (Reject đã bị lọc bỏ)
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          example: "Validation error"
        errors:
          type: object
          example: 
            dishIds: 
              msg: "dishIds must be an array"

    OrderDetailHistoryResponse:
      type: object
      properties:
        items:
          type: array
          description: Danh sách các món trong đơn hàng
          items:
            $ref: '#/components/schemas/HistoryDetailItem'

    # Schema chi tiết từng món (Theo đúng projection code của bạn)
    HistoryDetailItem:
      type: object
      properties:
        dishName:
          type: string
          example: "Bò Lúc Lắc"
        dishPrice:
          type: number
          example: 150000
        dishImage:
          type: string
          example: "https://cloudinary..."
        quantity:
          type: integer
          example: 2
        note:
          type: string
          example: "Ít tiêu"
        status:
          type: string
          enum: [Served, Reject, Processing, Pending]
          description: "Trạng thái món. Reject: Món đã bị hủy/trả."
        orderedBy:
          type: string
          description: Tên người gọi món (nếu có)
        # Các trường khác như managedBy, processingHistory vẫn có vì bạn không ẩn trong projection
        processingHistory:
          type: array
          items:
            type: object
            properties:
              status: 
                type: string
              updatedAt:
                type: string
                format: date-time
              updatedBy: 
                type: string
    HistoryOrderDetailResponse:
      type: object
      properties:
        items:
          type: array
          description: Danh sách chi tiết các món
          items:
            $ref: '#/components/schemas/HistoryItemDetail'

    # Schema chi tiết từng món ăn (Khớp với hình ảnh Postman)
    HistoryItemDetail:
      type: object
      properties:
        _id:
          type: string
          description: ID của item (OrderItem ID)
          example: "6945217b7c1fa2c05610bd00"
        dishName:
          type: string
          example: "Xúc xích nướng"
        dishPrice:
          type: number
          example: 12000
        dishImage:
          type: string
          example: "https://res.cloudinary.com/..."
        quantity:
          type: integer
          example: 2
        note:
          type: string
          example: "Không cay"
        orderedBy:
          type: string
          example: "Minh Nguyen"
        status:
          type: string
          enum: [Pending, Cooking, Served, Reject]
          example: "Served"
        createdAt:
          type: string
          format: date-time
          example: "2025-12-19T09:57:15.053Z"
        managedBy:
          type: string
          example: "Van Thu"
        processingHistory:
          type: array
          description: Lịch sử thay đổi trạng thái của món
          items:
            type: object
            properties:
              status:
                type: string
                example: "Cooking"
              updatedBy:
                type: string
                example: "Van Thu"
              updatedAt:
                type: string
                format: date-time
                example: "2025-12-19T09:58:05.712Z"
  
    SocialLink:
      type: object
      properties:
        platform:
          type: string
          enum: [Facebook, Instagram, Youtube, Tiktok, Zalo]
        url:
          type: string

    OpeningHour:
      type: object
      properties:
        label:
          type: string
          example: "Thứ 2 - Thứ 6"
        time:
          type: string
          example: "08:00 - 22:00"

    HeroSection:
      type: object
      properties:
        isActive:
          type: boolean
        images:
          type: array
          items:
            type: string
            description: URL ảnh banner

    AboutUsDetail:
      type: object
      properties:
        years:
          type: integer
          example: 10
        total_orders:
          type: integer
          example: 15000
        branches:
          type: integer
          example: 5
        percent_love:
          type: integer
          example: 99

    AboutUsSection:
      type: object
      properties:
        isActive:
          type: boolean
        title:
          type: string
        content:
          type: string
        image:
          type: string
        detail:
          $ref: '#/components/schemas/AboutUsDetail'

    GalleryItem:
      type: object
      properties:
        url:
          type: string
        description:
          type: string

    GallerySection:
      type: object
      properties:
        isActive:
          type: boolean
        title:
          type: string
        description:
          type: string
        images:
          type: array
          items:
            $ref: '#/components/schemas/GalleryItem'

    # --- 2. SCHEMA CHÍNH (RESPONSE) ---
    RestaurantSettings:
      type: object
      properties:
        _id:
          type: string
        brandName:
          type: string
        slogan:
          type: string
        description:
          type: string
        address:
          type: string
        hotline:
          type: string
        email:
          type: string
        logoUrl:
          type: string
        favicon:
          type: string
        
        # Các object con
        socialLinks:
          type: array
          items:
            $ref: '#/components/schemas/SocialLink'
        openingHours:
          type: array
          items:
            $ref: '#/components/schemas/OpeningHour'
        heroSection:
          $ref: '#/components/schemas/HeroSection'
        aboutUsSection:
          $ref: '#/components/schemas/AboutUsSection'
        gallerySection:
          $ref: '#/components/schemas/GallerySection'
    
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT